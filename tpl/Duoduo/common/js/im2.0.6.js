document.domain="fang.com",function(o,s){if(!o.fangimjs){var u=o.fangimjs={version:"3.0.0"},l=u.data={},i=B("Object"),d=B("String"),f=Array.isArray||B("Array"),h=B("Function"),e=0,c=l.events={};u.on=function(e,t){return(c[e]||(c[e]=[])).push(t),u},u.off=function(e,t){if(!e&&!t)return c=l.events={},u;var r=c[e];if(r)if(t)for(var n=r.length-1;0<=n;n--)r[n]===t&&r.splice(n,1);else delete c[e];return u};var v=u.emit=function(e,t){var r=c[e];if(r)for(var n=0,a=(r=r.slice()).length;n<a;n++)r[n](t);return u},t=/[^?#]*\//,p=/\/\.\//g,g=/\/[^/]+\/\.\.\//,y=/([^:/])\/+\//g,b=/^([^/:]+)(\/.+)$/,m=/{([^{]+)}/g,E=/^\/\/.|:\//,I=/^.*?\/\/.*?\//;u.resolve=function(e,t){if(!e)return"";var r,n,a,i,o,s,u,f;e=F(e),r=e,(a=l.paths)&&(n=r.match(b))&&d(a[n[1]])&&(r=a[n[1]]+n[2]),i=e=r,(o=l.vars)&&-1<i.indexOf("{")&&(i=i.replace(m,function(e,t){return d(o[t])?o[t]:e})),u=(s=e=i).length-1;var c=V(e=35===(f=s.charCodeAt(u))?s.substring(0,u):".js"===s.substring(u-2)||0<s.indexOf("?")||47===f?s:s+".js",t);return c=function(e){var t=l.map,r=e;if(t)for(var n=0,a=t.length;n<a;n++){var i=t[n];if((r=h(i)?i(e)||e:e.replace(i[0],i[1]))!==e)break}return r}(c=F(c))};var r,n,a,w="undefined"==typeof window&&"undefined"!=typeof importScripts&&h(importScripts),O=!location.href||/^(about|blob):/.test(location.href)?"":P(location.href);if(w){var A,C;try{throw new Error}catch(e){A=e.stack.split("\n")}A.shift();for(var _=/.*?((?:http|https|file)(?::\/{2}[\w]+)(?:[\/|\.]?)(?:[^\s"]*)).*?/i;0<A.length;){var x=A.shift();if(null!=(C=_.exec(x)))break}if(null!=C)var j=/(.*?):\d+:\d+\)?$/.exec(C[1])[1];r=P((n=j)||O),""===O&&(O=r)}else{var D=(S=document).scripts;function M(e){return e.hasAttribute?e.src:e.getAttribute("src",4)}r=P((n=M(S.getElementById("fangimnode")||function(){var e,t,r=D.length;for(t=r-1;0<=t&&-1===M(e=D[t]).indexOf("im2.0");t--);return e||D[r-1]}()))||O)}if(w){u.request=function(e,t,r){var n;try{importScripts(e)}catch(e){n=e}t(n)}}else{var S,q,W=(S=document).head||S.getElementsByTagName("head")[0]||S.documentElement,N=W.getElementsByTagName("base")[0];u.request=function(e,t,r){var n=S.createElement("script");if(r){var a=h(r)?r(e):r;a&&(n.charset=a)}!function(t,r,e){function n(e){t.onload=t.onerror=t.onreadystatechange=null,l.debug||W.removeChild(t),t=null,r(e)}"onload"in t?(t.onload=n,t.onerror=function(){v("error",{uri:e,node:t}),n(!0)}):t.onreadystatechange=function(){/loaded|complete/.test(t.readyState)&&n()}}(n,t,e),n.async=!0,n.src=e,q=n,N?W.insertBefore(n,N):W.appendChild(n),q=null}}var T,U=u.cache={},G={},R={},k={},L=$.STATUS={FETCHING:1,SAVED:2,LOADING:3,LOADED:4,EXECUTING:5,EXECUTED:6,ERROR:7};$.prototype.resolve=function(){for(var e=this.dependencies,t=[],r=0,n=e.length;r<n;r++)t[r]=$.resolve(e[r],this.uri);return t},$.prototype.pass=function(){for(var e=this,t=e.dependencies.length,r=0;r<e._entry.length;r++){for(var n=e._entry[r],a=0,i=0;i<t;i++){var o=e.deps[e.dependencies[i]];o.status<L.LOADED&&!n.history.hasOwnProperty(o.uri)&&(n.history[o.uri]=!0,a++,o._entry.push(n),o.status===L.LOADING&&o.pass())}0<a&&(n.remain+=a-1,e._entry.shift(),r--)}},$.prototype.load=function(){var e=this;if(!(e.status>=L.LOADING)){e.status=L.LOADING;var t=e.resolve();v("load",t);for(var r=0,n=t.length;r<n;r++)e.deps[e.dependencies[r]]=$.get(t[r]);if(e.pass(),e._entry.length)e.onload();else{var a,i={};for(r=0;r<n;r++)(a=U[t[r]]).status<L.FETCHING?a.fetch(i):a.status===L.SAVED&&a.load();for(var o in i)i.hasOwnProperty(o)&&i[o]()}}},$.prototype.onload=function(){this.status=L.LOADED;for(var e=0,t=(this._entry||[]).length;e<t;e++){var r=this._entry[e];0==--r.remain&&r.callback()}delete this._entry},$.prototype.error=function(){this.onload(),this.status=L.ERROR},$.prototype.exec=function(){var r=this;if(r.status>=L.EXECUTING)return r.exports;if(r.status=L.EXECUTING,r._entry&&!r._entry.length&&delete r._entry,r.hasOwnProperty("factory")){var n=r.uri;a.resolve=function(e){return $.resolve(e,n)},a.async=function(e,t){return $.use(e,t,n+"_async_"+X()),a};var e=r.factory,t=h(e)?e(a,r.exports={},r):e;return t===s&&(t=r.exports),delete r.factory,r.exports=t,r.status=L.EXECUTED,v("exec",r),r.exports}function a(e){var t=r.deps[e]||$.get(a.resolve(e));if(t.status==L.ERROR)throw new Error("module was broken: "+t.uri);return t.exec()}r.non=!0},$.prototype.fetch=function(e){var t=this,n=t.uri;t.status=L.FETCHING;var r={uri:n};v("fetch",r);var a=r.requestUri||n;function i(){u.request(r.requestUri,r.onRequest,r.charset)}a&&!R.hasOwnProperty(a)?G.hasOwnProperty(a)?k[a].push(t):(G[a]=!0,k[a]=[t],v("request",r={uri:n,requestUri:a,onRequest:function(e){delete G[a],R[a]=!0,T&&($.save(n,T),T=null);var t,r=k[a];delete k[a];for(;t=r.shift();)!0===e?t.error():t.load()},charset:h(l.charset)?l.charset(a)||"utf-8":l.charset}),r.requested||(e?e[r.requestUri]=i:i())):t.load()},$.resolve=function(e,t){var r={id:e,refUri:t};return v("resolve",r),r.uri||u.resolve(r.id,t)},$.define=function(e,t,r){var n=arguments.length;1===n?(r=e,e=s):2===n&&(r=t,f(e)?(t=e,e=s):t=s);var a={id:e,uri:$.resolve(e),deps:t,factory:r};if(!w&&!a.uri&&S.attachEvent&&void 0!==H){var i=H();i&&(a.uri=i.src)}v("define",a),a.uri?$.save(a.uri,a):T=a},$.save=function(e,t){var r=$.get(e);r.status<L.SAVED&&(r.id=t.id||e,r.dependencies=t.deps||[],r.factory=t.factory,r.status=L.SAVED,v("save",r))},$.get=function(e,t){return U[e]||(U[e]=new $(e,t))},$.use=function(e,a,t){var i=$.get(t,f(e)?e:[e]);i._entry.push(i),i.history={},i.remain=1,i.callback=function(){for(var e=[],t=i.resolve(),r=0,n=t.length;r<n;r++)e[r]=U[t[r]].exec();a&&a.apply(o,e),delete i.callback,delete i.history,delete i.remain,delete i._entry},i.load()},u.use=function(e,t){return $.use(e,t,l.cwd+"_use_"+X()),u},$.define.cmd={},u.define=$.define,o.define||(o.define=$.define),u.Module=$,l.fetchedList=R,l.cid=X,u.require=function(e){var t=$.get($.resolve(e));return t.status<L.EXECUTING&&(t.onload(),t.exec()),t.exports},l.base=r,l.dir=r,l.loader=n,l.cwd=O,l.charset="utf-8",u.config=function(e){for(var t in e){var r=e[t],n=l[t];if(n&&i(n))for(var a in r)n[a]=r[a];else f(n)?r=n.concat(r):"base"===t&&("/"!==r.slice(-1)&&(r+="/"),r=V(r)),l[t]=r}return v("config",e),u}}function B(t){return function(e){return{}.toString.call(e)=="[object "+t+"]"}}function X(){return e++}function P(e){return e.match(t)[0]}function F(e){var t=l.alias;return t&&d(t[e])?t[e]:e}function V(e,t){var r,n=e.charCodeAt(0);if(E.test(e))r=e;else if(46===n)r=(t?P(t):l.cwd)+e;else if(47===n){var a=l.cwd.match(I);r=a?a[0]+e.substring(1):e}else r=l.base+e;return 0===r.indexOf("//")&&(r=location.protocol+r),function(e){for(e=(e=e.replace(p,"/")).replace(y,"$1/");e.match(g);)e=e.replace(g,"/");return e}(r)}function H(){if(q)return q;if(a&&"interactive"===a.readyState)return a;for(var e=W.getElementsByTagName("script"),t=e.length-1;0<=t;t--){var r=e[t];if("interactive"===r.readyState)return a=r}}function $(e,t){this.uri=e,this.dependencies=t||[],this.deps={},this.status=0,this._entry=[]}}(this),function(t,r){var n=[],a=[],i=[],o=[],s=!1;r.config({alias:{jquery:"lib/jquery/1.11.2/jquery",swfobject:"lib/swfobject/2.2/swfobject",json2:"lib/json/2.0.0/json2"}}),t.fangWebIM=t.fangWebIM||{},t.fangWebIM.init=function(e){r.config({vars:{config:e}}),r.use(["main"],function(){for(;0<n.length;)t.fangWebIM.openChat(n.shift());0<a.length&&t.fangWebIM.addBroker(a),0<i.length&&t.fangWebIM.addConsultant(i),0<o.length&&t.fangWebIM.addCustomerService(o),!0===s&&t.fangWebIM.open()})},t.fangWebIM.reinit=function(e){r.config({vars:{config:e}}),t.fangWebIM.login()},t.fangWebIM.openChat=function(e){n.push(e)},t.fangWebIM.addBroker=function(e){a=e},t.fangWebIM.addConsultant=function(e){i=e},t.fangWebIM.addCustomerService=function(e){o=e},t.fangWebIM.open=function(){s=!0}}(window,fangimjs);;fangimjs.define("main",["jquery","event/event","controller/totalController","sdk/judgeSocket","setting/setting"],function(a){"use strict";var t=a("jquery"),e=fangimjs.data.vars,i=!1,n=window;var s,d,c,l,o,r=fangimjs.data.base;r=(r=r.substr(0,r.length-1)).substr(0,r.lastIndexOf("/")+1),fangimjs.data.base=r,s=r+"style/nsftalk2.0.1.css",d=n.document,c=d.head||d.getElementsByTagName("head")[0]||d.documentElement,l=c.getElementsByTagName("base")[0],(o=d.createElement("link")).charset="utf-8",o.rel="stylesheet",o.href=s,l?c.insertBefore(o,l):c.appendChild(o);var v=t('<div class="fbbox"></div>');t(n.document.body).append(v).append('<div id="swfContainer"></div>');var _='<div class="fbconl notmove" id="chatW_l" style="display:none;"><div class="fbconltit clearfix" id="chatW_L_DX"><div class="flol"><a id="im_shop_url" style="display:none;"><div class="flol im_head"><div class="im_head_img"></div><span class="im_status"></span></div></a><div class="flol im_name"></div><span class="flol im_status" style="display:none;"></span></div><div class="flor"><span class="im_tel"></span><i id="chatW_l_close"><a href="javascript:void(0);"><img src="'+r+'images/icon-close.png" width="12" height="12" /></a></i></div></div><div class="fbconlcon"><div class="fbcon"><ul id="chatW_l_msg"></ul></div><p id="chatW_l_alert"><span></span></p></div><div class="fbtools clearfix"><div class="sl"><i id="chatW_l_btn_face" class="im_face"></i><i class="no2"><form id="chatW_l_pic" enctype="multipart/form-data" action="" method="post" target=""></form></i><div id="chatW_l_face" class="biaoqi" style="display:none;"><div class="contnr"><div class="bqcon"></div></div></div></div><div class="sr" id="chatW_l_his"><a href="javascript:void(0);">\u6d88\u606f\u8bb0\u5f55</a></div></div><div class="textarea"><textarea id="chatW_l_text"></textarea></div><div class="fbbutr clearfix" id="chatW_l_send"><div class="sl"><a href="http://client.3g.fang.com/http/wap/index.html" target="_blank">\u4e0b\u8f7d\u623f\u5929\u4e0bAPP\uff0c\u6d88\u606f\u968f\u65f6\u968f\u5730\u770b\uff01</a></div><div class="sl" style="text-decoration:none; color:#333;">\u6309 Enter \u63d0\u4ea4</div><div class="sr"><a href="javascript:void(0);" class="fbbut01" id="chatW_l_btn_send">\u53d1\u9001</a></div></div></div><div class="fbconr" id="chatW_rt" style="display:none;"><div class="fbconrtit im_title"><a class="flor iconmin" href="javascript:void(0);" id="chatW_rt_min"></a><a class="flor iconclose" href="javascript:void(0);" id="chatW_rt_close" style="display:none;"></a><span class="im_online">\u5728\u7ebf</span></div><div class="listcon"><div class="conscroll"><div id="chatW_rt_contact"></div><div id="chatW_rt_contact_2"></div><div id="chatW_rt_contact_3"></div><div id="chatW_rt_contact_4"></div></div><div class="im_onlineTime" style="display: none;">\u5ba2\u670d\u5728\u7ebf\u65f6\u95f4\uff1a(\u4e0d\u5728\u7ebf\u53ef\u7559\u8a00)<br>\u6bcf\u5929 \u65e99:00~\u665a5:30</div></div><div class="btnOnline"><em></em>\u8054\u7cfb\u4eba [ <span>0</span>/<span>0</span> ]</div></div><div class="btnServiceUp" id="chatW_service" style="display: none;">\u8d2d\u623f\u5728\u7ebf\u54a8\u8be2</div><div class="btnMessage black0" id="chatW_newAlert" style="display: none;"><a href="javascript:;">\u60a8\u6709<span class="bold im_num" id="chatW_min_num">0</span>\u6761\u672a\u8bfb\u6d88\u606f</a></div><div class="btnPhone" id="chatW_worldPhone" style="display: none;">\u8d2d\u623f\u70ed\u7ebf\u7535\u8bdd<br>400-890-8753</div><div class="blue_alertCon" id="alertCon" style="display: none;"></div><div class="btnOnlineTalkUp" id="chatW_onlineTalk" style="display:none;"><div class="btnContactUp"><em></em>\u8054\u7cfb\u4eba [ <span id="chatW_rb_num1">0</span>/<span id="chatW_rb_num2">0</span> ]</div></div>';v.get(0).innerHTML=_,e.chatBox=v,e.chatBoxMain=v.find("#chatW_rt"),e.btnServiceUp=v.find("#chatW_service"),e.btnOnlineTalkUp=v.find("#chatW_onlineTalk"),e.chatBoxDetail=v.find("#chatW_l"),e.chatBoxNewMsg=v.find("#chatW_newAlert"),e.chatBoxPhone=v.find("#chatW_worldPhone"),e.onlineTimeCon=v.find(".im_onlineTime");var h=n.localStorage;try{h&&h.setItem("testPrivateModel",!1)}catch(a){h=null}e.localStorage=h,e.emojis=function(){for(var a=["\u5fae\u7b11","\u6487\u5634","\u8272","\u53d1\u5446","\u5f97\u610f","\u6d41\u6cea","\u5bb3\u7f9e","\u95ed\u5634","\u7761","\u5927\u54ed","\u5c34\u5c2c","\u53d1\u6012","\u8c03\u76ae","\u5472\u7259","\u60ca\u8bb6","\u96be\u8fc7","\u9177","\u51b7\u6c57","\u6293\u72c2","\u5410","\u5077\u7b11","\u6109\u5feb","\u767d\u773c","\u50b2\u6162","\u9965\u997f","\u56f0","\u60ca\u6050","\u6d41\u6c57","\u61a8\u7b11","\u60a0\u95f2","\u594b\u6597","\u5492\u9a82","\u7591\u95ee","\u5618","\u6655","\u75af\u4e86","\u54c0","\u9ab7\u9ac5","\u6572\u6253","\u518d\u89c1","\u64e6\u6c57","\u62a0\u9f3b","\u9f13\u638c","\u7cd7\u5927\u4e86","\u574f\u7b11","\u5de6\u54fc\u54fc","\u53f3\u54fc\u54fc","\u54c8\u6b20","\u9119\u89c6","\u59d4\u5c48","\u5feb\u54ed\u4e86","\u9634\u9669","\u4eb2\u4eb2","\u5413","\u53ef\u601c","\u83dc\u5200","\u897f\u74dc","\u5564\u9152","\u7bee\u7403","\u4e52\u4e53","\u5496\u5561","\u996d","\u732a\u5934","\u73ab\u7470","\u51cb\u8c22","\u5634\u5507","\u7231\u5fc3","\u5fc3\u788e","\u86cb\u7cd5","\u95ea\u7535","\u70b8\u5f39","\u5200","\u8db3\u7403","\u74e2\u866b","\u4fbf\u4fbf","\u6708\u4eae","\u592a\u9633","\u793c\u7269","\u62e5\u62b1","\u5f3a","\u5f31","\u63e1\u624b","\u80dc\u5229","\u62b1\u62f3","\u52fe\u5f15","\u62f3\u5934","\u5dee\u52b2","\u7231\u4f60","NO","OK","\u7231\u60c5","\u98de\u543b","\u8df3\u8df3","\u53d1\u6296","\u6004\u706b","\u8f6c\u5708","\u78d5\u5934","\u56de\u5934","\u8df3\u7ef3","\u6295\u964d","\u6fc0\u52a8","\u8857\u821e","\u732e\u543b","\u5de6\u592a\u6781","\u53f3\u592a\u6781"],t={},e=0;e<a.length;e++)t[a[e]]="emoji_"+(e+1001+"").substr(1)+".png";return t}();var f=a("controller/totalController"),p=a("event/event"),g=a("setting/setting").getInstance();f.init(),e.config.hidden&&p.trigger("view:window:change",g.WINDOW_STATUS_CLOSE),n.fangWebIM=n.fangWebIM||{},n.fangWebIM.openChat=function(a){i&&p.trigger("view:contacts:add",a)},n.fangWebIM.addBroker=function(a){a&&t.isArray(a)&&(e.broker=a,i&&p.trigger("view:otherContacts:add",{type:g.CONTACT_BROKER,data:a}))},n.fangWebIM.addConsultant=function(a){a&&t.isArray(a)&&(e.consultant=a,i&&p.trigger("view:otherContacts:add",{type:g.CONTACT_CONSULTANT,data:a}))},n.fangWebIM.addCustomerService=function(a){a&&t.isArray(a)&&(e.customerService=a,i&&p.trigger("view:otherContacts:add",{type:g.CUSTOMER_SERVICE,data:a}))},n.fangWebIM.open=function(){e.config.hidden=!1,f.open()},n.fangWebIM.logout=function(){p.trigger("socket:userstate:logout")},n.fangWebIM.login=function(){p.trigger("view:socket:login",!0)},p.on("socket:select",function(a){i=!0,f.setSocket(a),e.hasOwnProperty("broker")&&e.broker&&n.fangWebIM.addBroker(e.broker),e.hasOwnProperty("consultant")&&e.consultant&&n.fangWebIM.addConsultant(e.consultant),e.hasOwnProperty("customerService")&&e.customerService&&n.fangWebIM.addCustomerService(e.customerService)}),a("sdk/judgeSocket")()});;fangimjs.define("controller/totalController",["jquery","event/event","setting/setting","model/modelParse","view/textareaView","view/chatWindowView","view/contactListView","view/totalWindowView","util/util"],function(t,e,n){"use strict";var c=t("jquery"),o=t("event/event"),a=t("util/util"),u=t("setting/setting").getInstance(),f=t("model/modelParse").getInstance(),i=t("view/textareaView"),s=t("view/chatWindowView"),l=t("view/contactListView"),r=t("view/totalWindowView"),g=fangimjs.data.vars,d=g.config,w=!0;function p(){}!1===d.flash&&(w=!1),p.prototype={init:function(){var n=this;n.userState=!1,n.boxState=!1,n.readHistory=!1,i.init(),s.init(),l.init(),r.init(),o.on("view:contacts:add",function(e){w&&!a.getCookie("sfut")?(r.showSystemInfo({type:"sfut_null"}),i.lockTextarea()):n.setContactsState(e,function(t){f.changeContacts(e,t)})}),o.on("view:otherContacts:add",function(e){if(w&&!a.getCookie("sfut"))return!1;n.setContactsState(e.data,function(t){f.changeOtherContacts(e.data,e.type,t)},e.type)}),o.on("view:window:change",function(t){if(d.type===u.type.haiwai&&w&&!a.getCookie("sfut"))return r.showSystemInfo({type:"sfut_null"}),i.lockTextarea(),!1;f.setBoxState(t)}),o.on("view:msg:send",function(t){f.sendMsg(t),f.setNoUserReply("send")}),o.on("view:msg:history",function(t){var e;n.readHistory=!n.readHistory,e=n.readHistory?f.getSelectedContactHistoryMsg():f.getSelectedContactMsg(),s.updateMsg(e,n.readHistory)}),o.on("view:contact:selected",function(e){w&&!a.getCookie("sfut")&&(r.showSystemInfo({type:"sfut_null"}),i.lockTextarea()),f.uiData.selectedContactId!=e&&(n.setContactsState(e,function(t){f.setBoxStateAndSelectedContactId(u.WINDOW_STATUS_MAX,e,t)}),i.clearTextarea())}),o.on("view:otherContact:selected",function(e){w&&!a.getCookie("sfut")&&(r.showSystemInfo({type:"sfut_null"}),i.lockTextarea()),n.setContactsState(e.data,function(t){f.setOtherSelectedContact(e.data,e.type,t)},e.type),i.clearTextarea()}),o.on("view:socket:login",function(t){f.login(t)}),o.on("socket:userstate:logout",function(t){f.logout()}),o.on("model:contacts:change",function(t){l.updateContact(t)}),o.on("model:otherContacts:change",function(t){l.updateContact(t.data,t.type)}),o.on("model:contacts:numChange",function(t){r.changeContactNum(t),l.changeContactNum(t)}),o.on("model:contact:newMsg",function(t){l.updateNewMsg(t),r.showNewAlert(t)}),o.on("model:window:change",function(t){l.updateWinShow(t),r.updateWinShow(t),n.boxState=r.winStatus==u.WINDOW_STATUS_MAX||r.winStatus==u.WINDOW_STATUS_MAIN}),o.on("model:singlecontact:change",function(t){s.updateInfo(t),l.selectContact(t)}),o.on("model:msg:change",function(t){s.updateMsg(t)}),o.on("model:msg:alert",function(t){s.showAlert(t)}),o.on("model:contacts:pollingState",function(){n.pollingContactsState()}),o.on("model:singleContact:state",function(t){n.setContactsState(t,function(t){f.pollingContactsState(t)})}),o.on("socket:systemInfo:show",function(t){r.showSystemInfo(t),"verify_failure"===t.type&&i.lockTextarea()}),o.on("socket:state:set",function(t){n.userState=1==t}),o.on("socket:im:log",function(t){}),o.on("view:image:upload",function(t){f.setPicData(t)}),o.on("view:image:del",function(t){f.setPicData(""),i.showImg("")}),o.on("view:newmsg:click",function(t){f.setNewMsgShow()}),o.on("model:image:change",function(t){i.showImg(t)}),o.on("view:mouse:enter",function(t){f.setPageActive(t)}),o.on("socket:msgstring:show",function(t){s.showMsgString(t)}),o.on("view:msg:forbidden",function(t){f.sendMsg(t),f.setNoUserReply("send")}),g.config.type!==u.type.xf&&g.config.type!==u.type.esf&&g.config.type!==u.type.haiwai&&g.config.type!==u.type.sfb||f.setBoxState(u.WINDOW_STATUS_TINY)},setSocket:function(t){f.setSocket(t)},pollingContactsState:function(){var t=this;setInterval(function(){if(!t.userState||!t.boxState)return!1;t.setContactsState(f.contactsDataList,function(t){f.pollingContactsState(t)})},u.ONLINE_STATE_SEARCH_INTERVAL)},setContactsState:function(t,o,e){"string"==typeof t&&(t=e?f.getOtherContactDataById(t,e):f.getContactDataById(t));var n={},a=0,i=0,s=[];if(c.isArray(t)){if(t.length<1)return;for(a=t.length,i=0;i<a;i++)s.push(t[i].contactId)}else{if(!t)return;a=1,s.push(t.contactId)}n.username=s.join(","),c.ajax({url:u.ONLINE_PATH,data:n,dataType:"jsonp",jsonp:"callback",success:function(t){var e=t.result.split(","),n={};for(i=0;i<a;i++)n[s[i]]=1===parseInt(e[i])?1:0;o(n)},error:function(){o(n)}})},open:function(){r.open()}},n.exports=new p});;fangimjs.define("event/event",[],function(e,t,s){var o="sdkEvent:",n={"socket:select":1,"socket:master:set":1,"socket:msg:new":1,"socket:msg:change":1,"socket:ui:change":1,"socket:contactlist:change":1,"socket:systemInfo:show":1,"socket:im:log":1,"socket:state:set":1,"socket:userstate:logout":1,"userinfo:update":1,"userlist:update":1,"userpanel:update":1,"socket:selfdata:set":1,"message:new":1,"message:unread":1,"message:history":1,"assignsvrs:finish":1,"switchsvrs:finish":1,"loading:status":1,"notice:show":1,"history:empty":1,"action:click":1,"action:change":1,"msg:postback":1,"msg:posterror":1,"msg:chatWithback":1,"model:contact:newMsg":1,"model:contacts:change":1,"model:contacts:numChange":1,"model:singlecontact:change":1,"model:window:change":1,"model:msg:change":1,"model:msg:alert":1,"model:msg:receive":1,"model:msg:save":1,"model:otherContacts:change":1,"model:contacts:pollingState":1,"model:singleContact:state":1,"view:contacts:add":1,"view:contact:selected":1,"view:window:change":1,"view:newmsg:click":1,"view:msg:send":1,"view:msg:history":1,"view:otherContacts:add":1,"view:otherContact:selected":1,"view:socket:login":1,"view:image:upload":1,"view:image:del":1,"model:image:change":1,"view:mouse:enter":1,"socket:msgstring:show":1,"view:msg:frobidden":1},c=window.fangimjs;return{on:function(e,t){c.on(o+e,t)},off:function(e,t){c.off(o+e,t)},trigger:function(e,t){n[e]&&c.emit(o+e,t)}}});;fangimjs.define("model/modelParse",["event/event","setting/setting","jquery","sdk/flashSocket","sdk/pollingSocket","util/util","json2"],function(s,t,e){"use strict";var r=s("setting/setting").getInstance(),l=s("event/event"),u=s("jquery"),g=s("util/util"),i=s("json2"),a=fangimjs.data.vars,d=a.config,h=a.localStorage,m="fang_im_msg_data_list",n={},o={},f={default:"\u4eb2\u7231\u7684\u7528\u6237\uff0c\u5ba2\u670d\u6b63\u5fd9\uff0c\u60a8\u53ef\u4ee5\u5148\u6d4f\u89c8\u5176\u4ed6\u5185\u5bb9\uff0c\u6211\u4eec\u4f1a\u5c3d\u5feb\u56de\u590d\u60a8\u3002"};function p(t){var e=[];return e.push(t.getFullYear()),e.push("-"),e.push(t.getMonth()+1),e.push("-"),e.push(t.getDate()),e.push(" "),e.push(t.getHours()),e.push(":"),e.push((100+t.getMinutes()+"").substr(1)),e.push(":"),e.push((100+t.getSeconds()+"").substr(1)),e.join("")}function D(t){return{contactId:t.contactId||t.uid,showname:t.showname,newmsgnum:t.newmsgnum||0,state:t.state||0,type:t.type||"",latesttime:t.latesttime?t.latesttime:"",tip:t.tip||"",tel:t.tel||"",shop:t.shop||"",avatar:t.avatar||"",loupan:t.loupan||"",houseid:t.houseid||t.houseid||"",ShopID:t.ShopID||t.shopid||"",ShopType:t.ShopType||t.shoptype||"",projinfo:t.projinfo||"",saleorLease:t.saleorLease||""}}function c(t,e,a){for(var s in e){if(e[s][a]===t[a])return s}return-1}function I(t,e){for(var a=e.length,s=0;s<a;s++){var n=e[s];if(n.contactId==t)return n}return null}function y(t){for(var e=0,a=0,s=t.length,n=0;n<s;n++)1==t[n].state&&a++,e++;return{online:a,total:e}}d.type===r.type.sfb&&(f.custom={online:"\u60a8\u597d\uff0c\u8fd9\u91cc\u662f\u641c\u623f\u5e2e\u5728\u7ebf\u5ba2\u670d\uff0c\u5f88\u9ad8\u5174\u4e3a\u60a8\u670d\u52a1\uff01",offline:"\u60a8\u597d\uff0c\u73b0\u5728\u662f\u975e\u5de5\u4f5c\u65f6\u95f4\uff0c\u8bf7\u5728\u5468\u4e00\u5230\u5468\u4e94 9:00-18:00 \u671f\u95f4\u4e0e\u5ba2\u670d\u8fdb\u884c\u5728\u7ebf\u6c9f\u901a\uff0c\u6216\u8005\u60a8\u53ef\u62e8\u6253\u5ba2\u670d\u70ed\u7ebf 400-630-6888 \u7531\u503c\u73ed\u5ba2\u670d\u4e3a\u60a8\u670d\u52a1\uff0c\u7ed9\u60a8\u5e26\u6765\u7684\u4e0d\u4fbf\u656c\u8bf7\u8c05\u89e3\uff01",noUser:"\u5ba2\u670d\u672a\u6536\u5230\u60a8\u7684\u56de\u590d\uff0c\u5982\u6709\u9700\u8981\u53ef\u518d\u6b21\u54a8\u8be2\u6211\u4eec\uff0c\u795d\u6109\u5feb\uff01\u518d\u89c1",delay:18e4}),d.type===r.type.zxb&&(f.custom={online:"\u60a8\u597d\uff0c\u6211\u662f\u623f\u5929\u4e0b\u5bb6\u88c5\u987e\u95ee\uff0c\u5f88\u9ad8\u5174\u4e3a\u60a8\u670d\u52a1\uff01\u8bf7\u95ee\u6709\u4ec0\u4e48\u53ef\u4ee5\u5e2e\u60a8\u7684\uff1f",offline:"\u4eb2\u7231\u7684\u623f\u5929\u4e0b\u7528\u6237\uff0c\u60a8\u6709\u4ec0\u4e48\u95ee\u9898\u53ef\u4ee5\u76f4\u63a5\u7559\u8a00\uff0c\u5e76\u7559\u4e0b\u60a8\u65b9\u4fbf\u8054\u7cfb\u7684\u7535\u8bdd\u53f7\u7801\uff0c\u6211\u4eec\u7684\u5ba2\u670d\u4f1a\u5728\u5de5\u4f5c\u65f6\u95f4\u5c3d\u5feb\u4e0e\u60a8\u53d6\u5f97\u8054\u7cfb\uff0c\u795d\u60a8\u6109\u5feb\uff01",noUser:"\u611f\u8c22\u60a8\u7684\u54a8\u8be2\uff0c\u795d\u60a8\u751f\u6d3b\u6109\u5feb\uff01\u70ed\u7ebf\u7535\u8bdd\uff1a400-919-2000",delay:6e5});var v=function(){function e(t){this.isMaster=!1,this.selfData={},this.newMsgNum=0,this.contactsOnlineStatus={online:0,total:0},this.contactsDataList=[],this.otherContactsDataList={},this.msgDataList={},this.uiData={boxState:"",selectedContactId:""},this.picData={},this.PARM="contactId",this.init()}var a;return e.prototype={init:function(){var c=this;l.on("socket:master:set",function(t){c.setMaster(t)}),l.on("socket:msg:new",function(t){c.receiveMsg(t),c.setNoUserReply("receive")}),l.on("socket:msg:change",function(t){c.msgDataChange(t)}),l.on("socket:ui:change",function(t){c.setBoxStateAndSelectedContactId(t.boxState,t.selectedContactId)}),l.on("socket:contactlist:change",function(t){if(!function(t,e){if(t.length!=e.length)return!1;for(var a=t.length,s=0;s<a;s++){var n=t[s],o=e[s];if(n.contactId!=o.uid||n.newmsgnum!=o.newmsgnum||n.state!=o.state)return!1}return!0}(c.contactsDataList,t)){for(var e=t.length,a=0;a<e;a++)t[a]=D(t[a]);c.changeContacts(t)}}),l.on("socket:selfdata:set",function(t){c.selfData=t}),l.on("model:msg:save",function(t){var e=m+t,a=c.getSelectedContactHistoryMsg(t),s=c.msgDataList[t],n={};if(c.mergeMsgData(a,s,n)){var o=i.stringify(n.data);if(h)try{h.setItem(e,o)}catch(t){h.clear(),h.setItem(e,o)}}})},setSocket:function(t){this.socket=s(t),this.socket.initSocket()},login:function(t){t?this.socket.initSocket():this.socket.login()},logout:function(){this.socket.logout()},pollingContactsState:function(t){var e=this;(function(t,e){for(var a=!1,s=t.length,n=0;n<s;n++){var o=t[n];void 0!==e[o.contactId]&&o.state!=e[o.contactId]&&(o.state=e[o.contactId],a=!0)}return a})(e.contactsDataList,t)&&(e.changeContacts(e.contactsDataList),e.socket.setContactListData(e.contactsDataList))},changeContacts:function(t,e){var a=this;if(u.isArray(t)){a.contactsDataList=t,a.contactsOnlineStatus=y(a.contactsDataList),l.trigger("model:contacts:change",a.contactsDataList),l.trigger("model:contacts:numChange",a.contactsOnlineStatus);var s=I(a.uiData.selectedContactId,a.contactsDataList);s&&l.trigger("model:singlecontact:change",s),a.newMsgNum=function(t){for(var e=0,a=t.length,s=0;s<a;s++)t[s].newmsgnum&&(e+=+t[s].newmsgnum);return e}(a.contactsDataList),l.trigger("model:contact:newMsg",{contactData:s,totalMsg:a.newMsgNum})}else{var n=D(t),o=c(n,a.contactsDataList,a.PARM);if(-1<o)return n.loupan===a.contactsDataList[o].loupan&&n.houseid===a.contactsDataList[o].houseid&&n.showname===a.contactsDataList[o].showname&&n.ShopID===a.contactsDataList[o].ShopID&&n.ShopType===a.contactsDataList[o].ShopType&&n.projinfo===a.contactsDataList[o].projinfo||(a.contactsDataList[o]=n,l.trigger("model:contacts:change",a.contactsDataList),l.trigger("model:singlecontact:change",n),a.socket.setContactListData(a.contactsDataList)),void a.setBoxStateAndSelectedContactId(r.WINDOW_STATUS_MAX,n.contactId,e);e&&(n.state=e[n.contactId]),a.contactsDataList.unshift(n),a.socket.setContactListData(a.contactsDataList),a.contactsOnlineStatus=y(a.contactsDataList),l.trigger("model:contacts:change",a.contactsDataList),l.trigger("model:contacts:numChange",a.contactsOnlineStatus),a.socket.addContact(n),a.setBoxStateAndSelectedContactId(r.WINDOW_STATUS_MAX,n.contactId,e),n.tip&&a.sendMsg(n.tip,1)}},changeOtherContacts:function(t,e,a){if(u.isArray(t)){for(var s=t.length,n=[],o=[],c=0;c<s;c++){var i=a[(r=t[c]).contactId];(r.state=i)?n.push(r):o.push(r)}this.otherContactsDataList[e]=n.concat(o)}else{var r;i=a[(r=t).contactId];(r.state=i)?this.otherContactsDataList[e].unshift(r):this.otherContactsDataList[e].push(r)}l.trigger("model:otherContacts:change",{data:this.otherContactsDataList[e],type:e})},setOtherSelectedContact:function(t,e,a){var s=this.getOtherContactDataById(t,e);s&&(s.state=a[t],this.changeContacts(s,a))},getOtherContactDataById:function(t,e){for(var a=this.otherContactsDataList[e],s=a.length,n=0;n<s;n++)if(a[n].contactId==t)return a[n];return null},writeMsg:function(t){var e=t.msgMine?t.sendto:t.form;this.msgDataList[e]=this.msgDataList[e]||[],this.msgDataList[e].push(t)},writeContactData:function(t){var e=D(t);return this.contactsDataList.unshift(e),this.contactsOnlineStatus.online+=1==e.state?1:0,this.contactsOnlineStatus.total++,e},sendMsg:function(t,e){var a=this;if(!t)return g.trace("Wrong::modelParse.sendMsg--\u4e0d\u80fd\u53d1\u9001\u7a7a\u6570\u636e"),void l.trigger("model:msg:alert","\u53d1\u9001\u7684\u6d88\u606f\u4e0d\u80fd\u4e3a\u7a7a\uff01");var s=a.uiData.selectedContactId;if(s){var n=new Date,o=I(a.uiData.selectedContactId,a.contactsDataList),c={form:a.selfData.uid,caller:s,sendto:s,content:t,command:a.picData[s]?"img":"chat",agentId:d.agentid||a.selfData.uid,agentname:a.selfData.showname,msgMine:!0,time:p(n),id:n.getTime(),autoMsg:e||0,houseid:o.houseid||"",ShopID:o.ShopID||o.shopid||"",ShopType:o.ShopType||o.shoptype||"",projinfo:o.projinfo||"",saleorLease:encodeURIComponent(o.saleorLease||"")};if(a.setPicData(""),1!==e&&(a.writeMsg(c),l.trigger("model:msg:save",c.sendto),c.sendto==a.uiData.selectedContactId&&(l.trigger("model:msg:change",c),a.uiData.selectedContactId!=a.contactsDataList[0].contactId))){!function(t,e){for(var a=e.length,s=0;s<a;s++){var n=e[s];if(n.contactId==t){e.splice(s,1),e.unshift(n);break}}}(a.uiData.selectedContactId,a.contactsDataList),l.trigger("model:contacts:change",a.contactsDataList);var i=I(a.uiData.selectedContactId,a.contactsDataList);a.socket.setContactListData(a.contactsDataList),l.trigger("model:singlecontact:change",i)}return a.socket.sendMsg(c),!0}g.trace("Wrong::modelParse.sendMsg--\u8bf7\u9009\u62e9\u53d1\u9001\u5bf9\u8c61")},setNewMsgShow:function(){var t=this.getHasNewMsgContact();t&&this.setBoxStateAndSelectedContactId(r.WINDOW_STATUS_MAX,t.contactId)},getHasNewMsgContact:function(){for(var t=this.contactsDataList.length,e=0;e<t;e++)if(0!=this.contactsDataList[e].newmsgnum)return this.contactsDataList[e];return null},getHistory:function(){},setBoxState:function(t){t&&(t!=r.WINDOW_STATUS_MAX&&(this.uiData.selectedContactId=""),this.setBoxStateAndSelectedContactId(t,this.uiData.selectedContactId))},setBoxStateAndSelectedContactId:function(t,e,a){if(t!=r.WINDOW_STATUS_MAX&&""==e||t==r.WINDOW_STATUS_MAX&&e){var s=this,n=!1;if(s.uiData.boxState!=t&&(n=!0,s.uiData.boxState=t,l.trigger("model:window:change",s.uiData)),s.uiData.selectedContactId!=e){var o=!(n=!0);s.uiData.selectedContactId=e;var c=I(s.uiData.selectedContactId,s.contactsDataList);0<c.newmsgnum&&(s.newMsgNum-=c.newmsgnum,c.newmsgnum=0,l.trigger("model:contact:newMsg",{contactData:c,totalMsg:s.newMsgNum}),o=!0),a&&c.state!==a[c.contactId]&&(c.state=a[c.contactId],o=!0),l.trigger("model:singlecontact:change",c);var i=s.getSelectedContactMsg();l.trigger("model:msg:change",i),s.sendWelcome(c),l.trigger("model:image:change",s.picData[s.uiData.selectedContactId])}n&&s.socket&&s.socket.setUiData(s.uiData),o&&s.socket.setContactListData(s.contactsDataList)}},getSelectedContactMsg:function(){var t=this.msgDataList,e=this.uiData.selectedContactId;return t.hasOwnProperty(e)?t[e]:[]},getSelectedContactHistoryMsg:function(t){void 0===t&&(t=this.uiData.selectedContactId);var e,a=m+t;if(h)try{for(e=h.getItem(a);"string"==typeof e;)e=i.parse(e)}catch(t){g.trace("localStorage error")}return e||[]},setPicData:function(t){this.picData[this.uiData.selectedContactId]=t||void 0},setPageActive:function(t){null!=this.socket&&this.socket.setPageActive(t)},receiveMsg:function(t){var e=this,a=e.formatMsgData(t),s=e.msgDataList[a.caller];if(null==s||!e.sameMsgData(a,s[s.length-1])){var n=e.getContactDataById(a.caller);n||(n=e.writeContactData({contactId:a.caller,showname:a.caller}),l.trigger("model:contacts:change",e.contactsDataList),l.trigger("model:contacts:numChange",e.contactsOnlineStatus)),a.agentname=n.showname,e.writeMsg(a),l.trigger("model:msg:save",a.caller),a.caller==e.uiData.selectedContactId||a.caller==a.sendto?l.trigger("model:msg:change",a):(n.newmsgnum=n.newmsgnum||0,n.newmsgnum++,e.newMsgNum++,l.trigger("model:contact:newMsg",{contactData:n,totalMsg:e.newMsgNum}),e.socket.setContactListData(e.contactsDataList)),n&&l.trigger("model:singleContact:state",n)}},formatMsgData:function(t){var e=["chat","img","com_card","red_packets_cash","newhouses","house","voice","video","namecard","location","forbidden"][t.msgType],a={form:t.customerId,sendto:t.userid,content:t.content,command:e,purpose:t.msgPurpose,agentId:t.agentId,agentname:t.agentname||t.caller,msgMine:!!t.msgMine,caller:t.caller,time:t.time||p(new Date)};if(!a.msgMine){var s=this.getContactDataById(a.caller);s||(s=D({contactId:a.caller,showname:a.agentname}),this.changeContacts(s)),a.agentname=s.showname}return a},sameMsgData:function(t,e){return t.time===e.time&&t.content==e.content},formatMsgDataList:function(t){var e,a,s=[];if(u.isArray(t))for(a=t.length,e=0;e<a;e++)s.push(this.formatMsgData(t[e]));else s.push(this.formatMsgData(t));return s},getContactDataById:function(t){var e=c({contactId:t},this.contactsDataList,this.PARM);return this.contactsDataList[e]},msgDataChange:function(t){var e,a,s,n,o=this,c={},i=0,r=!1;for(e in t)a=u.makeArray(t[e]),c[e]=a;var g=o.msgDataList;for(e in c){if(r=!1,!g[e]||g[e].length<1)c[e]&&0<c[e].length&&(g[e]=o.formatMsgDataList(c[e]),r=!0);else{if(!c[e])break;if(s=g[e].length,n=c[e].length,c[e].length!=g[e].length){for(g[e].splice(0,s),i=0;i<n;i++)g[e][i]=o.formatMsgData(c[e][i]);r=!0,l.trigger("model:msg:save",e)}}!0===r&&e==o.uiData.selectedContactId&&l.trigger("model:msg:change",g[o.uiData.selectedContactId])}},mergeMsgData:function(t,e,a){var s,n,o,c,i=e,r=0,g=!1;if(!i||i.length<1)g=!1;else if(!t||t.length<1)i&&0<i.length&&(t=i,g=!0);else{for(o=t.length,c=i.length,s=t[o-1],r=c-1;0<=r&&(n=i[r],s.time!=n.time||s.content!=n.content);r--);if(r+1<=c-1){for(r=r+1;r<c;r++)t.push(i[r]);g=!0}}return a.data=t,g},setMaster:function(t){g.trace("Info::modelParse.setMaster",t),this.isMaster!=t&&(this.isMaster=t,l.trigger("model:contacts:pollingState"))},sendReplyMessage:function(t,e,a){var s=this;if(e){if(t){var n=s.getContactDataById(t),o=new Date,c={form:t,caller:t,sendto:s.selfData.uid,content:e,command:"chat",agentId:n.contactId,agentname:n.showname,msgMine:!1,time:p(o),id:o.getTime(),autoMsg:2,houseid:n.houseid||"",ShopID:n.ShopID||n.shopid||"",ShopType:n.ShopType||n.shoptype||"",projinfo:n.projinfo||""};return a?(s.writeMsg(c),l.trigger("model:msg:save",c.sendto),t===s.uiData.selectedContactId&&l.trigger("model:msg:change",c)):s.socket.sendMsg(c),!0}g.trace("Wrong::modelParse.sendAutoReplay--\u8bf7\u9009\u62e9\u53d1\u9001\u5bf9\u8c61")}else g.trace("Wrong::modelParse.sendAutoReplay--\u4e0d\u80fd\u53d1\u9001\u7a7a\u6570\u636e")},delayAutoReply:function(a,t){var s=this;clearTimeout(n[a]),d.type===r.type.jiaju?d.type===r.type.jiaju&&(n[a]=setTimeout(function(){var t,e;o[a]?(s.sendReplyMessage(a,o[a]),clearTimeout(n[a])):(t=a.split(":"),e={username:escape(t[1]||t[0])},u.ajax({url:r.JIAJU_AUTO_REPLY_PATH,data:e,cache:!0,dataType:"jsonp",timeout:r.POLLING_INTERVAL,jsonp:"callback",success:function(t){o[a]=decodeURIComponent(t),s.sendReplyMessage(a,o[a]),clearTimeout(n[a])}}))},t)):n[a]=setTimeout(function(){var t=f.default;d.type===r.type.zxb&&(t=f.custom.noUser),s.sendReplyMessage(a,t,!0),clearTimeout(n[a])},t)},setNoUserReply:function(t){var e=this.uiData.selectedContactId;if("receive"!==t||d.type!==r.type.zxb){if("send"===t){if(d.type===r.type.zxb)return void clearTimeout(n[e]);var a=this.getContactDataById(e),s=e.split(":")[0];"h"!==s&&"j"!==s||a.type!==r.type.jiaju||1===a.state&&this.delayAutoReply(e,3e4),"fs"===s&&a.type===r.type.haiwai&&1===a.state&&this.delayAutoReply(e,6e4)}}else this.delayAutoReply(e,f.custom.delay)},sendWelcome:function(t){var e=t.contactId,a=t.state,s="greet_"+e;if(d.type===r.type.sfb||d.type===r.type.zxb){var n="",o=(sessionStorage.getItem(s)||"0;0").split(";");return"1"!==o[1]&&1===a&&(n=f.custom.online,sessionStorage.setItem(s,o[0]+";1")),"1"!==o[0]&&0===a&&(n=f.custom.offline,sessionStorage.setItem(s,"1;"+o[1])),n&&this.sendReplyMessage(e,n,!0),void(1===a&&this.setNoUserReply("receive"))}if(t.type!==r.type.haiwai){if((d.type===r.type.xf||d.type===r.type.esf||d.type===r.type.zf)&&!sessionStorage.getItem(s)){var c="\u60a8\u597d\uff01\u6211\u662f\u7ecf\u7eaa\u4eba"+t.showname+"\uff0c\u8bf7\u95ee\u6709\u4ec0\u4e48\u53ef\u4ee5\u5e2e\u52a9\u60a8\uff1f";t.type===r.contacttype.consultant?c="\u60a8\u597d\uff01\u6211\u662f\u7f6e\u4e1a\u987e\u95ee"+t.showname+"\uff0c\u8bf7\u95ee\u6709\u4ec0\u4e48\u53ef\u4ee5\u5e2e\u52a9\u60a8\uff1f":t.type===r.contacttype.landlord&&(c="\u60a8\u597d\uff0c\u6709\u95ee\u9898\u8bf7\u7559\u8a00\uff0c\u770b\u5230\u540e\uff0c\u6211\u4f1a\u7b2c\u4e00\u65f6\u95f4\u7b54\u590d\u60a8\u3002"),this.sendReplyMessage(e,c,!0),sessionStorage.setItem(s,"1;1")}}else sessionStorage.getItem(s)||(this.sendReplyMessage(e,"\u4eb2\u7231\u7684\u7528\u6237\uff0c\u8fd9\u91cc\u662f\u623f\u5929\u4e0b\u6d77\u5916\u623f\u4ea7\uff0c\u8bf7\u95ee\u6709\u4ec0\u4e48\u9700\u8981\u5e2e\u52a9\uff1f",!0),sessionStorage.setItem(s,"1;1"))}},{name:"modelParse",getInstance:function(t){return void 0===a&&(a=new e(t)),a}}}();e.exports=v});;fangimjs.define("sdk/flashSocket",["util/util","setting/setting","swfobject","sdk/socket"],function(i,t,s){"use strict";var n=i("sdk/socket");function e(){var t=null;this.init(),this.core=function(){return null==t&&(t=i("swfobject").getObjectById("fang_im_swf")),t},this.initSocket=function(){var t=fangimjs.data.vars.config;this.initSocketData(t.username?"flashlg":"flash")}}e.prototype=n,s.exports=new e});;fangimjs.define("sdk/judgeSocket",["swfobject","event/event","util/util","setting/setting"],function(u,e,t){"use strict";t.exports=function(){var t=u("swfobject"),s=u("util/util"),a=u("event/event"),e=u("setting/setting").getInstance(),n="sdk/flashSocket",i=fangimjs.data.vars.config;function r(e){n=1===e?"sdk/flashSocket":"sdk/pollingSocket",s.trace("socket:select",n,(new Date).getTime()),a.trigger("socket:select",n)}var o=window;o.FangChat=o.FangChat||{},o.FangChat.completed=function(){var e=t.getObjectById("fang_im_swf");null!=e&&(g.remove(),f,function(e){try{e.callIM("OBJECT_VERIFY",{str:"false",sub:{arr:[0,1,2]}})}catch(e){s.trace("core.callIM OBJECT_VERIFY wrong")}}(e))},o.FangChat.verifyResult=function(e){e=e[0],s.trace("flash call js verifyResult is",e.result),1==e.result?r(1):r(0)},o.FangChat.setMaster=function(e){e=e[0],a.trigger("socket:master:set",e)},o.FangChat.setUserState=function(e){a.trigger("socket:state:set",e[0])},o.FangChat.imLog=function(e){s.debug&&a.trigger("socket:im:log",e)};var c=function(){var e,t,s=0,a=0;if(0<navigator.userAgent.indexOf("MSIE"))(e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))&&(s=1,t=e.GetVariable("$version"),a=parseInt(t.split(" ")[1].split(",")[0]));else if(navigator.plugins&&0<navigator.plugins.length&&(e=navigator.plugins["Shockwave Flash"])){s=1;for(var n=e.description.split(" "),i=0;i<n.length;++i)isNaN(parseInt(n[i]))||(a=parseInt(n[i]))}return{f:s,v:a}}();if(0!==c.f||!0!==i.flash)if(!1!==i.flash&&0!==c.f){var l,f=2,g=(l=0,{add:function(){0==l&&(l=setTimeout(function(){3,r(l=0)},3e3))},remove:function(){clearTimeout(l),l=0}});t.embedSWF(fangimjs.data.base+e.SWF_FILE,"swfContainer","6","1","10.0.0","expressInstall.swf",{},{menu:"false",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",bgcolor:"",wmode:"transparent"},{id:"fang_im_swf"},function(e){e.success?g.add():r(0)})}else r(0);else a.trigger("socket:systemInfo:show",{type:"flash_error"})}});;fangimjs.define("sdk/longConnectSocket",["jquery","json2","util/util","setting/setting","event/event"],function(e,t,s){"use strict";var o=e("jquery"),r=e("json2"),a=(e("event/event"),e("setting/setting").getInstance()),i=fangimjs.data.vars,n=e("util/util"),c=window,l=c.FangChat,m=(i=c.fangimjs.data.vars).localStorage,g="fang_im_contacts_list";i.config.type===a.type.sfb&&(g="sfb_im_contacts_list"),i.config.type===a.type.zxb&&(g="zxb_im_contacts_list");var f,d=0,u=0,y={url:a.LONG_CONNECT_REQUEST_PATH,type:"POST",method:"POST"};var p=[];function h(){this.contactList=[],this.newMsgIDList=[],this.storedMsgList=[],this.requestid=n.getGUID(),this.msgSendTimes=[],this.loginSetTimeOutFlag=0,this.pollingAjax=null}h.prototype={callIM:function(e,t){void 0===f?(p.push({type:e,data:t}),this.setAjaxProxy()):this.execIM(e,t)},execIM:function(e,t){var s=this;switch(e){case"CMD_JS_INIT":s.init(t);break;case"CMD_JS_ICON_CLICKED":s.iconClickHandle(t);break;case"CMD_JS_SEND_MES":s.sendMsg(t);break;case"CMD_JS_RE_CONNECT":s.login();break;case"SET_CONTACT_LIST_DATA":s.setContactsList(t);case"CMD_JS_LOGOUT":s.logout()}},init:function(e){var t=this,s=0;if(t.imei=n.getCookie("polling_imei"),t.imei||(t.imei=n.getGUID(),n.setCookie("polling_imei",t.imei,30)),e.username||(s=1,e.username=t.imei,e.showname="\u7f51\u53cb-"+t.imei.substr(0,6)),t.selfData={city:e.city,regType:s,showname:e.showname||e.username,state:2,userType:e.usertype,usercookie:e.cookie},t.selfData.username=(1===s?"w:":"wl:")+e.username,y=o.extend(y,{xhr:f,dataType:"json",headers:{"WebIM-UserName":encodeURIComponent(e.username)}}),t.selfData.uid=t.selfData.username,l.setSelfData([t.selfData]),m)try{for(var a=m.getItem(g);"string"==typeof a;)a=r.parse(a);t.contactList=a||[]}catch(e){n.trace("localStorage error")}o.isArray(t.contactList)&&0<t.contactList.length&&(l.contactListDataChange([t.contactList]),t.selfData.usercookie=t.selfData.username),t.selfData.usercookie&&t.login(),l.setMaster([!0])},setAjaxProxy:function(){var e=this,t=o('<iframe src="'+a.AJAX_PROXY_PATH+'" style="display:none"></iframe>');o(document.body).append(t);var s=t.get(0);s.onload=function(){e.getAjaxProxy(s)}},getAjaxProxy:function(e){var t=this,s=e.contentDocument||e.contentWindow.document;if(s&&s.readyState&&"complete"==s.readyState){var a=e.contentWindow.getXhr||e.getXhr;if("function"==typeof a)for(f=a();0<p.length;){var i=p.shift();t.execIM(i.type,i.data)}}else setTimeout(function(){t.getAjaxProxy(e)},100)},login:function(){var t=this;if(t.loginSetTimeOutFlag&&(clearTimeout(t.loginSetTimeOutFlag),t.loginSetTimeOutFlag=0),2===t.selfData.state){t.showSystemInfo("login"),t.selfData.state=0;var e={command:"login",imei:t.imei,os:"web",username:t.selfData.username,usertype:t.selfData.userType,city:t.selfData.city,version:"",nickname:t.selfData.showname};o.ajax(o.extend({data:e},y)).done(function(e){t.loginSuccess(e)}).fail(function(e){0===e.status&&(y=o.extend(y,{dataType:"jsonp",jsonp:"callback"})),l.sendLog(["web",t.selfData.uid+","+t.selfData.city+",login fail begin relogin"]),t.showSystemInfo("socket_error",3e3),t.setUserState(2),t.loginSetTimeOutFlag=setTimeout(function(){t.reLogin()},3e3)})}},reLogin:function(){var e=this;if(3<++u)return u=0,l.sendLog(["web",e.selfData.uid+","+e.selfData.city+",login fail relogin count > 3"]),e.showSystemInfo("socket_close"),void e.setUserState(2);e.login()},setContactsList:function(e){if(e&&o.isArray(e)){this.contactList=e;try{m&&m.setItem(g,r.stringify(this.contactList))}catch(e){n.trace("localStorage error")}}},iconClickHandle:function(){2==this.selfData.state&&this.login()},loginSuccess:function(e){var t=this;if(200==e.state){if(t.showSystemInfo("sucess"),t.setUserState(1),l.setSelfData([t.selfData]),t.selfData.regType&&l.loginSuccess([t.selfData.username]),t.polling(),0<t.storedMsgList.length)for(var s=t.storedMsgList.length,a=0;a<s;a++)t.sendMsg(t.storedMsgList.shift());l.sendLog(["web",t.selfData.uid+","+t.selfData.city+",login success"])}else t.showSystemInfo("socket_error"),t.setUserState(2),l.sendLog(["web",t.selfData.uid+","+t.selfData.city+",login fail data state != 200"])},setUserState:function(e){this.selfData.state=e,l.setUserState([e]),1!==e?this.showSystemInfo("socket_error"):this.showSystemInfo("sucess")},polling:function(){var t=this,e={command:"request",requestid:t.requestid,from:t.selfData.username};t.pollingAjax&&t.pollingAjax.abort(),t.pollingAjax=o.ajax(o.extend({data:e,timeout:a.POLLING_INTERVAL},y)).done(function(e){t.pollingAjax=null,t.receiveMsg(e)}).fail(function(){t.pollingAjax=null,t.polling()})},receiveMsg:function(e){var t=this;if(!e||"close"!=e.command){if(e&&"-100"==e.state)return 1===t.selfData.state&&t.setUserState(2),void t.login();if(t.polling(),o.isArray(e)){var s=e.length,a=[];l.imLog(["poll",r.stringify(e)]);for(var i=0;i<s;i++){var n=e[i];n.from&&(-1===o.inArray(n.messageid,t.newMsgIDList)&&(n.showname=n.nickname,n.caller=n.from,n.msgMine=!1,n.id=n.messageid,n.time=n.messagetime,n.customerId=n.from,n.userid=n.sendto,n.content=n.message,"img"==n.command?n.msgType=1:"com_card"==n.command?n.msgType=2:"red_packets_cash"==n.command?n.msgType=3:"newhouses"==n.command?(n.msgType=4,n.msgPurpose=n.purpose):"house"==n.command?n.msgType=5:"voice"==n.command?n.msgType=6:"video"==n.command?n.msgType=7:"namecard"==n.command?n.msgType=8:"location"==n.command?n.msgType=9:"forbidden"==n.command?n.msgType=10:(n.msgType=0,"anli"==n.purpose&&(n.msgPurpose=n.purpose)),n.agentId=n.caller,t.newMsgIDList.push(n.messageid),l.recvMsg([n])),a.push(n.messageid))}t.msgAck(a)}}},msgAck:function(e){var t={command:"msgack",messageid:e.join(","),from:this.selfData.username};o.ajax(o.extend({data:t},y))},sendMsg:function(t){if(2!=t.autoMsg){var s=this;void 0===t.messageid&&(t.messageid=d++);var a={from:t.from||t.form,sendto:t.sendto,message:t.content||t.message,type:s.selfData.userType,clienttype:"web",command:t.command,nickname:s.selfData.showname,ShopID:t.ShopID,ShopType:t.ShopType,projinfo:t.projinfo,saleorLease:t.saleorLease},i=function(e){s.storedMsgList.push(e)};if(1!=s.selfData.state)return i(t),void s.showSystemInfo("socket_error");var n=function(e){s.msgSendTimes[e.messageid]<3&&s.sendMsg(e)};void 0===s.msgSendTimes[t.messageid]&&(s.msgSendTimes[t.messageid]=0),s.msgSendTimes[t.messageid]+=1,o.ajax(o.extend({data:a,cache:!0},y)).done(function(e){if(e&&"-100"==e.state)return i(t),void l.sendLog(["web",s.selfData.uid+","+s.selfData.city+",send fail delay send callback data state error,"+r.stringify(a)]);!e||"img_ret"!=e.command&&"chat_ret"!=e.command||"200"!=e.state?(l.sendLog(["web",s.selfData.uid+","+s.selfData.city+",send fail resend callback data command error"+r.stringify(a)]),n(t)):l.sendLog(["web",s.selfData.uid+","+s.selfData.city+",send success,"+r.stringify(a)])}).fail(function(){l.sendLog(["web",s.selfData.uid+","+s.selfData.city+",send fail resend ajax fail"+r.stringify(a)]),n(t)})}},sendMsgBack:function(e){},showSystemInfo:function(e,t){var s={type:e,value:t};l.sysInfo([s])},logout:function(){this.setUserState(2)}},s.exports=new h});;fangimjs.define("sdk/pollingSocket",["util/util","setting/setting","sdk/longConnectSocket","sdk/socket"],function(n,t,i){"use strict";var e=n("sdk/socket");function o(){var t=null;this.init(),this.core=function(){return null==t&&(t=n("sdk/longConnectSocket")),t},this.initSocket=function(){var t=fangimjs.data.vars.config;this.initSocketData(t.username?"weblg":"web")}}o.prototype=e,i.exports=new o});;fangimjs.define("sdk/socket",["jquery","util/util","setting/setting","event/event"],function(t,a,e){"use strict";var n=t("jquery"),c=t("event/event"),o=t("util/util"),r="CMD_JS_SEND_MES",i=window;return{init:function(){i.FangChat=i.FangChat||{},i.FangChat.recvMsg=function(t){t=t[0],c.trigger("socket:msg:new",t)},i.FangChat.uiDataChange=function(t){t=t[0],c.trigger("socket:ui:change",t)},i.FangChat.contactListDataChange=function(t){t=t[0],c.trigger("socket:contactlist:change",t)},i.FangChat.msgDataChange=function(t){var a={};for(var e in t=t[0])if(t.hasOwnProperty(e)){var n=e;"_flash_toxml_"===n.substr(0,13)&&(n=n.substr(13)),a[n.replace("_____",":")]=t[e]}c.trigger("socket:msg:change",a),o.trace("flash call js:contactDataChange",a)},i.FangChat.addMsgString=function(t){t=t[0],c.trigger("socket:msgstring:show",t)},i.FangChat.loginSuccess=function(t){t=t[0],o.setCookie("fangchatcookie",t,30)},i.FangChat.setSelfData=function(t){c.trigger("socket:selfdata:set",t[0])},i.FangChat.sysInfo=function(t){t=t[0],c.trigger("socket:systemInfo:show",t)},i.FangChat.getSfut=function(){return o.getCookie("sfut")},i.FangChat.logout=function(){c.trigger("socket:userstate:logout")},i.FangChat.sendLog=function(t){var a={c:"tools",a:"imLog",type:t[0],mesg:t[1]};n.ajax({url:"http://ditu.fang.com/index.php",method:"GET",data:a}).done(function(t){o.trace(t.errmsg||"\u65e5\u5fd7\u8bb0\u5f55\u6210\u529f")}).fail(function(t){o.trace(t.errmsg||"\u65e5\u5fd7\u8bb0\u5f55\u5931\u8d25")})}},login:function(){try{this.core().callIM("CMD_JS_RE_CONNECT")}catch(t){o.trace("core().callIM CMD_JS_RE_CONNECT wrong")}},sendMsg:function(t){if(t.sendto){var a=t;a.location=i.location.href,"img"==t.command&&(a.msgContent="100,100");try{this.core().callIM(r,a)}catch(t){o.trace("core().callIM CMD_JS_SEND_MES wrong")}}else o.trace("sendMsg::data.sendto in null")},sendImage:function(t){if(t.sendto){var a={command:"img",mesContent:t.content,sendto:t.sendto,imgWidth:100,imgHeight:100};a.location=i.location.href;try{this.core().callIM(r,a)}catch(t){o.trace("core().callIM CMD_JS_SEND_MES wrong")}}else o.trace("sendImage::data.sendto in null")},setUiData:function(t){try{this.core().callIM("SET_UI_DATA",t)}catch(t){o.trace("core().callIM SET_UI_DATA wrong")}},setContactListData:function(t){try{this.core().callIM("SET_CONTACT_LIST_DATA",t)}catch(t){o.trace("core().callIM SET_CONTACT_LIST_DATA wrong")}},addContact:function(t){try{!t.username&&(t.username=t.contactId),this.core().callIM("CMD_JS_ICON_CLICKED",t)}catch(t){o.trace("core().callIM SET_CONTACT_DATA wrong")}},setPageActive:function(t){try{this.core().callIM("CMD_JS_PAGE_ACTIVE",t)}catch(t){o.trace("core().callIM SET_CONTACT_DATA wrong")}},initSocketData:function(t){var a=fangimjs.data.vars.config,e={cookie:o.getCookie("fangchatcookie")||"",userid:a.userid||"",username:a.username||"",showname:a.showname||a.username||"",city:a.city||"\u5317\u4eac",usertype:t};try{this.core().callIM("CMD_JS_INIT",e)}catch(t){o.trace("core().callIM CMD_JS_INIT wrong")}},logout:function(){try{this.core().callIM("CMD_JS_LOGOUT")}catch(t){o.trace("core().callIM CMD_JS_LOGOUT wrong")}}}});;fangimjs.define("setting/setting",[],function(t,i,e){"use strict";var s=function(){function i(t){this.POLLING_INTERVAL=4e4,this.ONLINE_STATE_SEARCH_INTERVAL=12e4,this.ONLINE_PATH="http://chat.client.3g.fang.com/OnLine",this.LONG_POLLING_SERVER="http://webim.client.3g.fang.com/",this.SWF_FILE="swf/webim2.0.7.swf",this.LONG_CONNECT_REQUEST_PATH=this.LONG_POLLING_SERVER+"longPolling",this.AJAX_PROXY_PATH=this.LONG_POLLING_SERVER+"ajaxproxy.html",this.JIAJU_AUTO_REPLY_PATH="http://home.fang.com/jiancai/interface/DealerReplyJquery.aspx",this.UPLOAD_IMG_PATH="http://img1u.soufun.com/upload/mchat?channel=webim&city=",this.UPLOAD_IMG_BACK_URL_PATH="http://activities.m.fang.com/im/?c=imchat",this.WINDOW_STATUS_MAX="max",this.WINDOW_STATUS_MAIN="main",this.WINDOW_STATUS_MIN="min",this.WINDOW_STATUS_TINY="tiny",this.WINDOW_STATUS_CLOSE="close",this.CONTACT_RECENT="recent",this.CONTACT_CONSULTANT="consultant",this.CONTACT_BROKER="broker",this.CUSTOMER_SERVICE="customerService",this.MAX_MSG_NUM=30,this.type={xf:"webxf",esf:"webesf",zf:"agent",jiaju:"home",haiwai:"world",sfb:"sfb",zxb:"zxb"},this.contacttype={consultant:"webxf",esf:"webesf",zf:"agent",jiaju:"home",haiwai:"world",sfb:"sfb",zxb:"zxb",landlord:"landlord"}}var e;return{name:"settingSingle",getInstance:function(t){return void 0===e&&(e=new i(t)),e}}}();e.exports=s});;fangimjs.define("util/util",[],function(e,t,o){var n=function(){};n.prototype.getCookie=function(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?decodeURIComponent(t[2]):""},n.prototype.setCookie=function(e,t,o){var n="";if(o){var r=new Date;isNaN(o)&&(o=3),r.setTime(r.getTime()+24*o*60*60*1e3),n=r.toGMTString()}document.cookie=e+"="+encodeURIComponent(t)+"; path=/; expires="+n},n.prototype.encodeString=function(e){var t=new RegExp("<","g");return e=e.replace(t,"&lt;"),t=new RegExp(">","g"),e=e.replace(t,"&gt;")},n.prototype.getGUID=function(){var e=0,t="";for(e=0;e<8;e++)t+="0123456789abcdef".charAt(Math.round(15*Math.random()));return t+=("00000000"+(new Date).getTime().toString(16).toLocaleLowerCase()).substr(-8)},n.prototype.trace=function(){void 0===this.debug&&(this.debug=-1<window.location.href.indexOf("debug")),this.debug&&console.log(Array.prototype.join.call(arguments," | "))},o.exports=new n});;fangimjs.define("view/chatWindowView",["jquery"],function(a,t,e){"use strict";var l=a("jquery"),i=fangimjs.data.base,s=fangimjs.data.vars;function r(){this.chatWAlert="#chatW_l_alert",this.chatWMsg="#chatW_l_msg",this.chatLTitle="#chatW_L_DX",this.onlineClass="online",this.avatar="http://js.soufunimg.com/common_m/m_public/images/fang.jpg",this.userAvatar=s.config.avatar||i+"images/user.png"}r.prototype={init:function(){this.$chatLTitle=l(this.chatLTitle),this.msgShow=l(this.chatWMsg),this.alertShow=l(this.chatWAlert)},updateMsg:function(a,t){var e=this,i=[],s=e.msgShow;if(l.isArray(a)){var r=a.length;t&&i.push("<li>-----"+(0<r?"\u672c\u5730\u6d88\u606f\u8bb0\u5f55\u5982\u4e0b":"\u65e0\u672c\u5730\u6d88\u606f\u8bb0\u5f55")+"-----</li>");for(var n=0;n<r;n++)i.push(e.makeMsgStr(a[n]));s.html(i.join(""))}else if("forbidden"===a.command){this.msgShow.find("li.me").last().append('<div class="icon_send_error"><span>!</span></div>'),s.append('<li class="replyforbidden"><span>\u60a8\u5df2\u88ab\u7cfb\u7edf\u7981\u8a00</span></li>')}else s.append(e.makeMsgStr(a));s.parent().animate({scrollTop:s.height()},200)},makeMsgStr:function(a){var t=this,e='<li class="{{im_chat_class}}">{{im_user_image}}<div class="replybox"><div class="replycontent"><span class="arrow">&nbsp;</span>{{im_chat_content}}</div></div></li>';e=e.replace(/{{im_chat_class}}/g,a.msgMine?"even me":"odd chatother");var i=l('<div><a class="user" target="_blank"><img src="'+t.userAvatar+'" width="46" height="46" /></a></div>');a.msgMine||i.find("img").attr("src",t.avatar),e=e.replace(/{{im_user_image}}/g,i.html());var s=t.getContentByCommand(a.command,a.purpose,a.content);return e=e.replace(/{{im_chat_content}}/g,s)},getContentByCommand:function(a,t,e){var i=this,s="",r=null,n=[];switch(a){case"img":s='<a href="'+e+'" target="_blank"><img src="'+e+'" width="100"/></a>';break;case"com_card":r=JSON.parse(e),s=['<div style="width:272px;">','<div class="refy">'+i.textOverflow(r.title1,18)+"</div>",'<div class="refytr02">','<div class="sl"><a href="'+r.wapurl+'" target="_blank"><img src="'+r.img+'" width="80" height="60"></a></div>','<div class="sr">','<h2><a href="'+r.wapurl+'" target="_blank">'+i.textOverflow(r.title2,8)+"</a></h2>","<p>"+r.desc1+"   "+r.desc2+"</p>",'<p><span class="red">'+r.tap1+"</span></p>",'<div class="zybq">'+r.fromtype+"</div>","</div></div></div>"].join("");break;case"namecard":r=JSON.parse(e),s=['<div style="width:272px;">','<div class="refya"><span>'+i.textOverflow(r.rightuptip,23)+"</span>\u4e2a\u4eba\u540d\u7247</div>",'<div class="refytr02">','<div class="sla"><a href="javascript:void(0);"><img src="'+r.photourl+'" width="80" height="60"></a></div>','<div class="sr w170">','<h2><a href="javascript:void(0);">'+r.nameline+"</a></h2>","<ul><li>"+i.textOverflow(r.description1,28)+"</li>","<li>"+i.textOverflow(r.description2,28)+"</li></ul>","</div></div></div>"].join("");break;case"red_packets_cash":case"red_packets_cash_ret":s="[\u73b0\u91d1\u7ea2\u5305]";break;case"newhouses":n=e.split(";");var l={xfb_soufun_redbag:"\u623f\u5929\u4e0b\u7ea2\u5305",xfb_house:"\u697c\u76d8",xfb_huxing:"\u6237\u578b"}[t];s='<a title="'+n[4]+'" href="'+n[10]+'" target="_blank">['+l+"] "+n[4]+" "+n[10]+"</a>";break;case"house":s='<a title="'+(n=e.split(";"))[4]+'" href="'+n[14]+'" target="_blank">[\u623f\u6e90] '+n[4]+" "+n[14]+"</a>";break;case"voice":s="[\u8bed\u97f3]";break;case"video":s="[\u89c6\u9891]";break;case"location":s="[\u4f4d\u7f6e]";break;default:s="anli"===t?'<a title="'+(n=e.split(";"))[0]+'" href="'+n[1]+'" target="_blank">[\u6848\u4f8b] '+n[0]+" "+n[0]+"</a>":i.replaceFace(e)}return s},textOverflow:function(a,t){var e=t||10,i=a;return i.length>e?i.substr(0,e)+"...":i},replaceFace:function(a){var t=fangimjs.data.vars.emojis,e=a.replace(/\[([^\]]*)\]/g,function(){return t[arguments[1]]?'<img src="'+i+"images/emoji_s/"+t[arguments[1]]+'" width="24" border="0" />':"["+arguments[1]+"]"});return e||(e=(e=(e=(e=(e=(e=l.trim(e)).replace(/\</g,"&lt;")).replace(/\>/g,"&gt;")).replace(/\"/g,"&quot;")).replace(/\s+/g,"&nbsp;")).replace(/\n/g,"<br/>")),e},updateInfo:function(a){var t=this;if(a.hasOwnProperty("loupan")&&a.loupan){var e=20<a.loupan.length?a.loupan.substr(0,20)+"...":a.loupan,i=e+": "+a.showname+"\u4e3a\u60a8\u670d\u52a1";"landlord"===a.type&&(i=e),t.$chatLTitle.find(".im_name").html(i)}else t.$chatLTitle.find(".im_name").html(a.showname+"\u4e3a\u60a8\u670d\u52a1");a.hasOwnProperty("tel")&&a.tel?t.$chatLTitle.find(".im_tel").html(a.tel).show():t.$chatLTitle.find(".im_tel").hide(),a.hasOwnProperty("avatar")&&a.avatar?(t.$chatLTitle.find(".im_head_img").html('<img src="'+a.avatar+'" alt="'+a.showname+'">'),t.avatar=a.avatar):t.$chatLTitle.find(".im_head_img").html('<img src="'+t.avatar+'" alt="'+a.showname+'">');var s=t.$chatLTitle.find(".im_status");1!=a.state?s.removeClass(t.onlineClass):s.addClass(t.onlineClass)},showAlert:function(a){var t=l("<li>*****"+a+"*****</li>");this.msgShow.append(t),t.fadeOut(1e3),this.msgShow.parent().animate({scrollTop:this.msgShow.height()},200)},showMsgString:function(a){var t=l("<li>*****"+a+"*****</li>");this.msgShow.append(t),this.msgShow.parent().animate({scrollTop:this.msgShow.height()},200)}},e.exports=new r});;fangimjs.define("view/contactListView",["jquery","event/event","setting/setting"],function(t,n,a){"use strict";var u=t("jquery"),o=t("event/event"),d=fangimjs.data.vars,m=t("setting/setting").getInstance();function s(){this.rightCon="#chatW_rt",this.contactsTotalCon=".conscroll",this.chatWContact1="#chatW_rt_contact",this.chatWContact2="#chatW_rt_contact_2",this.chatWContact3="#chatW_rt_contact_3",this.chatWContact4="#chatW_rt_contact_4";var t='<div class="conts"><em class="on"></em><a href="javascript:void(0);">*</a><span class="news" style="display:none;"></span></div>';this.contact1Text=t.replace("*","\u6700\u8fd1\u8054\u7cfb\u4eba"),this.contact2Text=t.replace("*","\u672c\u697c\u76d8\u7f6e\u4e1a\u987e\u95ee"),this.contact3Text=t.replace("*","\u672c\u5730\u7ecf\u7eaa\u4eba"),this.contact4Text=t.replace("*","\u5728\u7ebf\u5ba2\u670d"),this.contactH3Class="on",this.currentClass="on",this.onlineClass="",this.notOnlineClass="no2",this.winClass="max",this.listCon='<ul class="rlist"></ul>',this.chatRB="#chatW_rb",this.chatRBNum1="#chatW_rb_num1",this.chatRBNum2="#chatW_rb_num2",this.chatRTUNum1="#chatW_rt_up_num1",this.chatRTUNum2="#chatW_rt_up_num2"}s.prototype={init:function(){var t=this;t.chatBox=d.chatBox,t.chatBoxMain=d.chatBoxMain,t.chatBoxDetail=d.chatBoxDetail,t.chatBoxNewMsg=d.chatBoxNewMsg,t.conScroll=t.chatBoxMain.find(t.contactsTotalCon).on("click","li",function(){t.selectContactByClick(this)}).on("click",".conts",function(){t.showOrHideLiset(this)}),t.jContact1=t.conScroll.find(t.chatWContact1).append(t.contact1Text+t.listCon),t.onlineTalk=t.chatBoxMain.find(".btnOnline").on("click",function(){o.trigger("view:window:change",m.WINDOW_STATUS_TINY)})},selectContactByClick:function(t){var n=this,a=u(t),s="#"+a.closest("div").attr("id");if(s==n.chatWContact1)o.trigger("view:contact:selected",a.attr("id"));else{var c="";switch(s){case n.chatWContact2:c=m.CONTACT_CONSULTANT;break;case n.chatWContact3:c=m.CONTACT_BROKER;break;case n.chatWContact4:c=m.CUSTOMER_SERVICE}o.trigger("view:otherContact:selected",{data:a.attr("id"),type:c})}n.conScroll.scrollTop(0)},selectContact:function(t){var n=this,a=n.jContact1.find("ul").children();a.removeClass(n.currentClass);for(var s=a.length,c=0;c<s;c++){var o=u(a[c]);if(o.attr("id")==t.contactId){var e=1!=t.state?n.notOnlineClass:n.onlineClass;t.state;o.removeClass().addClass([e,n.currentClass].join(" ")),o.find(".news").addClass("nonews").html("");break}}},changeContactNum:function(t){var n=this;void 0===n.jContactOnline&&(n.jContactOnline=n.onlineTalk.find("span:first")),void 0===n.jContactTotal&&(n.jContactTotal=n.onlineTalk.find("span:last")),n.jContactOnline.html(t.online.toString()),n.jContactTotal.html(t.total.toString())},updateNewMsg:function(t){var n=this,a=t.totalMsg||0;void 0===n.jContactNewMsgNum&&(n.jContactNewMsgNum=n.jContact1.find(".conts .news")),n.jContactNewMsgNum.html(0<a?a:"");var s=t.contactData;if(s)for(var c=n.jContact1.find("ul").children(),o=c.length,e=0;e<o;e++){var i=u(c[e]);if(i.attr("id")==s.contactId){0<s.newmsgnum?i.find(".news").removeClass("nonews").html(s.newmsgnum):i.find(".news").removeClass("red");break}}},showOrHideLiset:function(t){var n=this,a=u(t),s=a.find("em");s.hasClass(n.contactH3Class)?s.removeClass(n.contactH3Class):s.addClass(n.contactH3Class),a.next().toggle()},toggleBoxMain:function(){var t=this;t.chatBoxBar.is(":visible")?(t.chatBoxMain.show(),t.chatBoxBar.hide()):(t.chatBoxMain.hide(),t.chatBoxBar.show())},updateWinShow:function(t){var n=this,a=n.jContact1.find("ul");t.boxState==m.WINDOW_STATUS_MAIN?a.removeClass(n.winClass):a.addClass(n.winClass)},updateContact:function(t,n){var a=this,s=n||m.CONTACT_RECENT,c=a.chatWContact1;if(s!=m.CONTACT_RECENT){var o="";switch(s){case m.CONTACT_CONSULTANT:c=a.chatWContact2,o=a.contact2Text;break;case m.CONTACT_BROKER:c=a.chatWContact3,o=a.contact3Text;break;case m.CUSTOMER_SERVICE:c=a.chatWContact4,o=a.contact4Text}u(c).empty().append(o+a.listCon)}var e=u(c).find("ul"),i=t;e.empty();for(var l=[],h=i.length,r=0,C=0;C<h;C++)l.push('<li id="'),l.push(i[C].contactId),l.push('" title="'),l.push(i[C].showname),l.push('" class="'),l.push(1!=i[C].state?this.notOnlineClass:this.onlineClass),l.push('"><span class="talk_ft">'),l.push(i[C].listname||i[C].showname),l.push('</span><span class="news nonews'),l.push(0<+i[C].newmsgnum?' red">'+i[C].newmsgnum:'">'),l.push("</span></li>"),r+=+i[C].newmsgnum;e.html(l.join("")),c==a.chatWContact1&&(void 0===a.jContactNewMsgNum&&(a.jContactNewMsgNum=a.jContact1.find(".conts .news")),a.jContactNewMsgNum.removeClass("nonews").html(0<r?r:"")),a.conScroll.scrollTop(0),c===a.chatWContact1&&0<h&&d.config.showIcon&&(u.isFunction(d.config.showIcon)&&d.config.showIcon(),d.config.showIcon=null)}},a.exports=new s});;fangimjs.define("view/textareaView",["jquery","event/event","setting/setting"],function(t,e,a){"use strict";var c=t("jquery"),o=t("setting/setting").getInstance(),n=t("event/event");function i(){this.status="active",this.chatWPic="#chatW_l_pic",this.chatWTA="#chatW_l_text",this.chatWFace="#chatW_l_face",this.chatFaceBtn="#chatW_l_btn_face",this.chatSendBtn="#chatW_l_btn_send",this.chatWHis="#chatW_l_his",this.defaultText="\u70b9\u51fb\u8fd9\u91cc\uff0c\u76f4\u63a5\u8f93\u5165\u6d88\u606f\u54a8\u8be2..."}i.prototype={init:function(){var i=this;i.textarea=c(i.chatWTA),i.sendButton=c(i.chatSendBtn),i.textarea.on("focus",function(t){var e=c(this);if(i.picData)e.blur();else{var a=e.val();e.css("color","#000"),a&&a==i.defaultText&&e.val("")}}),i.textarea.on("blur",function(t){var e=c(this);e.val()||i.picData||e.css("color","").val(i.defaultText)}),i.textarea.on("keydown",function(t){13===t.keyCode&&(t.preventDefault(),i.showImg(i.picData),i.sendMsg())}),i.jChatWHis=c(i.chatWHis).on("click",function(){n.trigger("view:msg:history")}),i.sendButton.on("click",function(){i.sendMsg()}),i.faceBtn=c(i.chatFaceBtn),i.faceBox=c(i.chatWFace),i.faceBoxInner=i.faceBox.find(".bqcon").on("click","img",function(t){t.stopPropagation(),i.toggleFaceBox(),i.textarea.val()===i.defaultText&&i.textarea.val(""),i.textarea.focus(),i.insertFace("["+c(this).attr("data-face")+"]")}),i.faceBtn.on("click",function(t){t.stopPropagation(),i.faceBoxInner.html()||i.faceBoxInner.html(i.createFaceBox()),i.toggleFaceBox()}),c(document).click(function(){i.faceBtn.removeClass("on"),i.faceBox.hide()}),i.picForm=c(i.chatWPic),i.file=i.createFileInput(),i.fileType=["jpeg","jpg","gif","png","bmp"];var t=window;t.FangChat=t.FangChat||{},t.FangChat.picUploadComplete=function(t){i.closeTip(),t?(i.picData=t,n.trigger("view:image:upload",t),i.showTip('\u56fe\u7247\u4e0a\u4f20\u6210\u529f\uff0c\u8bf7\u53d1\u9001\u3002 <a href="'+t+'" target="_blank" data-id="look">\u67e5\u770b</a> <a href="javascript:;" data-id="del">\u5220\u9664</a>')):i.showTip("\u4e0a\u4f20\u56fe\u7247\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u4e0a\u4f20",!0),i.file=i.createFileInput()}},sendMsg:function(){var t=this;t.closeTip();var e=t.picData||c.trim(t.textarea.val());if(e==this.defaultText||""==e)return t.showTip("\u53d1\u9001\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165...",!0),t.textarea.focus(),!1;t.clearTextarea(),t.picData=void 0,n.trigger("view:msg:send",e)},uploadTalkPic:function(){var t=this,e=(fangimjs.data.vars.config.city,o.UPLOAD_IMG_BACK_URL_PATH),a=Math.round(100*Math.random()),i=o.UPLOAD_IMG_PATH+"&sid="+a+"&backurl="+e;if(t.checkFileType()){var n=t.createLoadFrame();t.picForm.attr({action:i,encoding:"multipart/form-data",target:n,method:"Post"}),t.showTip("\u4e0a\u4f20\u4e2d\uff0c\u8bf7\u7a0d\u5019..."),t.picForm.submit()}},createFileInput:function(){var e=this,t=Math.round(1e4*Math.random());if(e.file&&e.file.off().remove(),-1===window.location.host.indexOf("fang.com"))return!1;var a='<input name="file'+t+'" type="file" title="\u53d1\u9001\u56fe\u7247" style="filter:alpha(opacity=0);opacity:0;cursor:pointer;display:block;margin-left:-70px;margin-top:-5px;">';return e.file=c(a),e.picForm.empty().append(e.file),e.file.on("change",function(t){e.uploadTalkPic()}),e.file},createLoadFrame:function(){var t="fc"+this.file.attr("name"),e=fangimjs.data.vars.picframe;return c("iframe[name="+e+"]").remove(),fangimjs.data.vars.picframe=t,c('<iframe name="'+t+'" width="0" height="0" scrolling="no" frameBorder="0" style="visibility:hidden;"></iframe>').appendTo(document.body),t},checkFileType:function(){var t=this,e=t.file.val(),a=!1,i=e.lastIndexOf(".");if(-1!=i){var n=e.substr(i+1).toLowerCase();-1===c.inArray(n,t.fileType)?alert("\u4e0d\u652f\u6301\u6587\u4ef6\u7c7b\u578b"+n+",\u652f\u6301"+t.fileType.join(",")+"\u56fe\u7247\u7c7b\u578b\u6587\u4ef6\uff01"):a=!0}else alert("\u8bf7\u4e0a\u4f20"+t.fileType.join(",")+"\u56fe\u7247\u7c7b\u578b\u6587\u4ef6\uff01");return a},createFaceBox:function(){var t="",e=fangimjs.data.vars.emojis;for(var a in e)t+='<a href="javascript:void(0)"><img src="'+fangimjs.data.base+"images/emoji_s/"+e[a]+'" width="24" data-face="'+a+'" title="'+a+'"/></a>';return t},toggleFaceBox:function(){var t=this;t.faceBtn.hasClass("on")?(t.faceBtn.removeClass("on"),t.faceBox.hide()):(t.faceBtn.addClass("on"),t.faceBox.show())},insertFace:function(t,e){document.getElementById(this.chatWTA);var a=this.textarea[0];if(document.selection){a.focus();var i=document.selection.createRange();i.text=t,a.focus();var n=a.value.length;i.moveStart("character",-n);var c=i.text.length;2==arguments.length&&(i.moveEnd("character",c+e),e<=0?i.moveStart("character",c-2*e-t.length):i.moveStart("character",c-e-t.length),i.select())}else if(a.selectionStart||"0"==a.selectionStart){var o=a.selectionStart,r=a.selectionEnd,s=a.scrollTop;a.value=a.value.substring(0,o)+t+a.value.substring(r,a.value.length),a.focus(),a.selectionStart=o+t.length,a.selectionEnd=o+t.length,a.scrollTop=s,2==arguments.length&&(a.setSelectionRange(o-e,a.selectionEnd+e),a.focus())}else a.value+=t,a.focus()},showTip:function(t,e){var a=this;a.tip||(a.tip=c('<p class="talkNull gray6" style="display: none"></p>'),a.textarea.before(a.tip),a.tip.on("click","a[data-id=del]",function(){n.trigger("view:image:del"),a.closeTip()})),a.tip.html(t).show(),a.clearTextarea(),e?(a.tip.removeClass("iconChenggong"),setTimeout(function(){a.closeTip()},3e3)):a.tip.addClass("iconChenggong")},closeTip:function(){this.tip&&this.tip.hide()},showImg:function(t){var e=this;e.picData=t,e.closeTip(),t?(e.showTip('\u4f60\u4e0a\u4f20\u8fc7\u56fe\u7247\uff0c\u8bf7\u53d1\u9001\u3002 <a href="'+t+'" target="_blank" data-id="look">\u67e5\u770b</a> <a href="javascript:;" data-id="del">\u5220\u9664</a>'),e.clearTextarea()):e.textarea.focus()},clearTextarea:function(){this.textarea.val("")},updateUI:function(t){var e=t?1:0;this.jChatWHis.css("border",e+"px solid #999")},lockTextarea:function(){this.status="locked",this.textarea.css("color","#fff").attr("disabled",!0),this.sendButton.css("background-color","#888").off("click"),this.faceBtn.off("click"),this.file.attr("disabled",!0)}},a.exports=new i});;fangimjs.define("view/totalWindowView",["jquery","event/event","setting/setting","util/drag/1.0.0/drag"],function(t,e,a){"use strict";var c=t("jquery"),h=t("event/event"),l=fangimjs.data.vars,r=t("setting/setting").getInstance(),i=t("util/drag/1.0.0/drag"),d=!0;function n(){this.chatW="#chatW",this.chatWR="#chatW_rt",this.chatWL="#chatW_l",this.chatWLC="#chatW_l_close",this.chatWRM="#chatW_rt_min",this.chatWRC="#chatW_rt_close",this.newAlert="#chatW_newAlert",this.newAlertNum="#chatW_min_num",this.btnServiceClass="btnService",this.btnServiceUpClass="btnServiceUp",this.btnOnlineTalkClass="btnOnlineTalk",this.btnOnlineTalkUpClass="btnOnlineTalkUp",this.alertConId="#alertCon",this.FLASH_TIME=1e3,this.flashAlertFunc=0,this.showText="\u3010\u65b0\u6d88\u606f*\u6761\u3011",this.winStatus="",this.orginTitle="",this.loginSetTimeOutFlag=0}n.prototype={init:function(){var o=this;o.doc=c(document),o.chatWRClose=c(o.chatWRC),o.orginTitle=o.doc.attr("title"),o.chatBox=l.chatBox,o.chatBoxMain=l.chatBoxMain,o.chatBoxDetail=l.chatBoxDetail,o.chatBoxNewMsg=l.chatBoxNewMsg,o.chatBoxPhone=l.chatBoxPhone,o.onlineTimeCon=l.onlineTimeCon,o.btnServiceUp=l.btnServiceUp,o.btnOnlineTalkUp=l.btnOnlineTalkUp,l.config.type===r.type.sfb&&(o.btnServiceUp.html("\u641c\u623f\u5e2e\u5728\u7ebf\u54a8\u8be2").css("font","bold 16px/35px SimSun"),o.onlineTimeCon.html("\u5ba2\u670d\u5728\u7ebf\u65f6\u95f4\uff1a(\u4e0d\u5728\u7ebf\u53ef\u7559\u8a00)<br>\u5468\u4e00\u5230\u5468\u4e94 \u65e99:00~\u665a5:30")),l.config.closeBtnShow||o.chatWRClose.hide(),o.btnServiceUp.on("click",function(){var t="";t=o.btnServiceUp.hasClass(o.btnServiceClass)?r.WINDOW_STATUS_TINY:r.WINDOW_STATUS_MAIN,h.trigger("view:window:change",t)}),o.btnOnlineTalkUp.on("click",function(){h.trigger("view:window:change",r.WINDOW_STATUS_MAIN)}),c(o.chatWLC).on("click",function(){h.trigger("view:window:change",r.WINDOW_STATUS_MAIN)}),c(o.chatWRM).on("click",function(){h.trigger("view:window:change",r.WINDOW_STATUS_TINY)}),o.chatBoxNewMsg.on("click",function(){h.trigger("view:newmsg:click")});var e=!1;function a(t){var e=c(window).height(),a=c(window).width(),i=(o.chatBox.offset(),a-t.left-t.width),n=e-t.top-t.height;o.chatBoxDetail.removeClass("notmove"),i<210&&n<30?o.chatBoxDetail.addClass("notmove").css({left:"",top:"",right:"",bottom:""}):i<210?o.chatBoxDetail.css({left:"",top:t.top,right:"",bottom:""}):n<30?o.chatBoxDetail.css({left:t.left,top:"",right:"",bottom:"-2px"}):o.chatBoxDetail.css({left:t.left,top:t.top,right:"",bottom:""})}o.doc.on("mouseenter mouseover.fangChat",function(t){e||h.trigger("view:mouse:enter",!0),e=!0,o.doc.off("mouseover.fangChat")}),o.doc.on("mouseleave",function(t){h.trigger("view:mouse:enter",!1),e=!1}),o.dragBar=o.chatBoxDetail.find("#chatW_L_DX"),o.dragBar.on(i.types.start,function(t){i.create(o.chatBoxDetail,t,{onEnd:a})})},updateWinShow:function(t){var e=this;if(!(e.winStatus===t.boxState||l.config.hidden&&t.boxState!==r.WINDOW_STATUS_CLOSE)){switch(e.winStatus===r.WINDOW_STATUS_CLOSE&&e.chatBox.show(),e.winStatus=t.boxState,e.winStatus){case r.WINDOW_STATUS_MAX:e.btnServiceUp.removeClass().addClass(e.btnServiceClass).hide(),e.btnOnlineTalkUp.removeClass().addClass(e.btnOnlineTalkClass).hide(),e.chatBoxMain.add(e.chatBoxDetail).show(),e.flashAlertFunc&&e.chatBoxNewMsg.hide(),l.config.type===r.type.haiwai&&e.chatBoxPhone.hide(),e.chatBox.css({height:"556px",width:"180px"});break;case r.WINDOW_STATUS_MAIN:e.btnServiceUp.removeClass().addClass(e.btnServiceClass).hide(),e.btnOnlineTalkUp.removeClass().addClass(e.btnOnlineTalkClass).hide(),e.chatBoxMain.show(),e.chatBoxDetail.hide(),e.chatBox.css({height:"556px",width:"180px"}),e.chatBoxPhone.hide(),e.chatBoxNewMsg.hide();break;case r.WINDOW_STATUS_TINY:l.config.type===r.type.haiwai||l.config.type===r.type.sfb?(e.btnServiceUp.removeClass().addClass(e.btnServiceUpClass).show(),e.btnOnlineTalkUp.removeClass().addClass(e.btnOnlineTalkClass).hide(),e.chatBox.css("height","35px")):(e.btnServiceUp.removeClass().addClass(e.btnServiceClass).hide(),e.btnOnlineTalkUp.removeClass().addClass(e.btnOnlineTalkUpClass).show(),e.chatBox.css("height","30px")),e.chatBoxMain.add(e.chatBoxDetail).hide(),e.chatBoxDetail.css({left:"",top:"",right:"",bottom:""}),e.flashAlertFunc&&e.chatBoxNewMsg.show(),l.config.type===r.type.haiwai&&e.chatBoxPhone.show();break;case r.WINDOW_STATUS_CHAT:e.btnServiceUp.removeClass().addClass(e.btnServiceClass).hide(),e.btnOnlineTalkUp.removeClass().addClass(e.btnOnlineTalkClass).show(),e.chatBoxMain.hide(),e.chatBox.css("height","30px"),e.chatBoxPhone.hide(),e.chatBoxNewMsg.hide();break;case r.WINDOW_STATUS_CLOSE:e.chatBox.hide();break;default:console.log("totalWindowView.js updateWinShow error!")}d&&(d=!1)}},changeContactNum:function(t){var e=this;void 0===e.jContactOnline&&(e.jContactOnline=e.btnOnlineTalkUp.find("span:first")),void 0===e.jContactTotal&&(e.jContactTotal=e.btnOnlineTalkUp.find("span:last")),e.jContactOnline.html(t.online.toString()),e.jContactTotal.html(t.total.toString())},showNewAlert:function(t){var e=this,a=t.totalMsg;clearInterval(e.flashAlertFunc),e.flashAlertFunc=0,e.doc.attr("title",e.orginTitle),a<=0?e.chatBoxNewMsg.hide():(l.config.type===r.type.haiwai&&e.chatBoxPhone.hide(),c(e.newAlertNum).html(a),e.winStatus===r.WINDOW_STATUS_TINY?e.chatBoxNewMsg.show():e.winStatus===r.WINDOW_STATUS_CLOSE&&l.config.newMesg&&c.isFunction(l.config.newMesg)&&l.config.newMesg(),e.flashAlertFunc=setInterval(function(){e.doc.attr("title")===e.orginTitle?e.doc.attr("title",e.showText.replace("*",a)):e.doc.attr("title",e.orginTitle)},e.FLASH_TIME))},showSystemInfo:function(t){var e=t.type,a=t.value,i="",n=!1;switch(e){case"login":i=this.loginInfo(a),2==a&&(n=!0);break;case"sucess":i="\u8fde\u63a5\u670d\u52a1\u5668\u6210\u529f",n=!0;break;case"kick":i="\u8be5\u5e10\u6237\u5df2\u5728\u5176\u4ed6\u5ba2\u6237\u7aef\u767b\u5f55";break;case"socket_close":i="\u670d\u52a1\u5668\u8fde\u63a5\u9519\u8bef\uff0c\u5df2\u5173\u95ed";break;case"socket_error":a=3e3,i="\u670d\u52a1\u5668\u9519\u8bef\uff0c\u5c06\u5728"+parseInt(a/1e3)+'\u79d2\u540e\u91cd\u65b0\u8fde\u63a5\uff0c<a href="javascript:;" class="im_reconnect">\u7acb\u5373\u91cd\u8fde</a>';break;case"max_times":i='\u670d\u52a1\u5668\u9519\u8bef\uff0c<a href="javascript:;" class="im_reconnect">\u7acb\u5373\u91cd\u8fde</a>';break;case"flash_error":i="\u5f53\u524dIM\u7cfb\u7edf\u9700\u8981flash\u63d2\u4ef6\u652f\u6301,<br/>\u8bf7\u5b89\u88c5.";case"hide":break;case"verify_failure":i='\u8bf7\u60a8 <a href="https://passport.fang.com?backurl='+window.location.href+'">\u91cd\u65b0\u767b\u5f55</a>';break;case"sfut_null":i='\u8bf7 <a href="https://passport.fang.com?backurl='+window.location.href+'" >\u767b\u5f55</a> \u540e\u54a8\u8be2',l.config.type===r.type.xf&&c(this.alertConId).addClass("webxf")}var o,s=c(this.alertConId);i?(s.html(i).show(),0<s.find("a.im_reconnect").length&&s.find("a.im_reconnect").on("click",function(){clearTimeout(o),h.trigger("view:socket:login")}),"socket_error"===e&&(o=setTimeout(function(){h.trigger("view:socket:login")},a)),n&&setTimeout(function(){s.hide()},2e3),d&&this.updateWinShow({boxState:r.WINDOW_STATUS_TINY})):s.is(":visible")&&s.hide()},loginInfo:function(t){var e="";switch(t){case 1:e="\u6b63\u5728\u7b49\u5f85\u670d\u52a1\u5668\u56de\u5e94...";break;case 2:e="\u76ee\u524d\u5904\u4e8e\u8fde\u63a5\u72b6\u6001";break;case 3:e="\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u94fe\u63a5\uff0c\u91cd\u65b0\u767b\u9646\u3002";break;default:e="\u6b63\u5728\u8fde\u63a5\u670d\u52a1\u5668..."}return e},open:function(){this.flashAlertFunc?h.trigger("view:newmsg:click"):h.trigger("view:window:change",r.WINDOW_STATUS_MAIN)}},a.exports=new n});;!function(e){var o=[],n="lib/jquery/1.11.2/jquery",r=e.jQuery,t=r&&r.fn.jquery.split(".");(void 0===r||1===parseInt(t[0])&&parseInt(t[1])<7)&&(e.module?"object"!=typeof e.module.exports&&(e.module.exports={}):e.module={exports:{}},o.push(n+"__")),fangimjs.define(n,o,function(e){return 0<o.length?e(n+"__"):r})}(window);;fangimjs.define("lib/json/2.0.0/json2",[],function(){"use strict";var JSON={},cx,escapable,gap,indent,meta,rep;function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var r,n,u,f,o,a=gap,p=t[e];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(e)),"function"==typeof rep&&(p=rep.call(t,e,p)),typeof p){case"string":return quote(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(p)){for(f=p.length,r=0;r<f;r+=1)o[r]=str(r,p)||"null";return u=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+a+"]":"["+o.join(",")+"]",gap=a,u}if(rep&&"object"==typeof rep)for(f=rep.length,r=0;r<f;r+=1)"string"==typeof rep[r]&&(u=str(n=rep[r],p))&&o.push(quote(n)+(gap?": ":":")+u);else for(n in p)Object.prototype.hasOwnProperty.call(p,n)&&(u=str(n,p))&&o.push(quote(n)+(gap?": ":":")+u);return u=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+a+"}":"{"+o.join(",")+"}",gap=a,u}}return escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,t,r){var n;if(indent=gap="","number"==typeof r)for(n=0;n<r;n+=1)indent+=" ";else"string"==typeof r&&(indent=r);if((rep=t)&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){var j;function walk(e,t){var r,n,u=e[t];if(u&&"object"==typeof u)for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(void 0!==(n=walk(u,r))?u[r]=n:delete u[r]);return reviver.call(e,t,u)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")},JSON});;fangimjs.define("swfobject",[],function(e,t,a){var H=function(){var s,c,f,d,l,p,m="undefined",w="object",u="Shockwave Flash",v="application/x-shockwave-flash",y="SWFObjectExprInst",e="onreadystatechange",h=window,g=document,b=navigator,C=!1,n=[function(){C?function(){var t=g.getElementsByTagName("body")[0],a=V(w);a.setAttribute("type",v);var n=t.appendChild(a);if(n){var i=0;!function(){if(typeof n.GetVariable!=m){var e=n.GetVariable("$version");e&&(e=e.split(" ")[1].split(","),N.pv=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)])}else if(i<10)return i++,setTimeout(arguments.callee,10);t.removeChild(a),n=null,I()}()}else I()}():I()}],E=[],S=[],o=[],i=!1,A=!1,r=!0,N=function(){var e=typeof g.getElementById!=m&&typeof g.getElementsByTagName!=m&&typeof g.createElement!=m,t=b.userAgent.toLowerCase(),a=b.platform.toLowerCase(),n=/win/.test(a||t),i=/mac/.test(a||t),r=!!/webkit/.test(t)&&parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),o=!1,l=[0,0,0],s=null;if(typeof b.plugins!=m&&typeof b.plugins[u]==w)!(s=b.plugins[u].description)||typeof b.mimeTypes!=m&&b.mimeTypes[v]&&!b.mimeTypes[v].enabledPlugin||(o=!(C=!0),s=s.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),l[0]=parseInt(s.replace(/^(.*)\..*$/,"$1"),10),l[1]=parseInt(s.replace(/^.*\.(.*)\s.*$/,"$1"),10),l[2]=/[a-zA-Z]/.test(s)?parseInt(s.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof h.ActiveXObject!=m)try{var c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");c&&(s=c.GetVariable("$version"))&&(o=!0,s=s.split(" ")[1].split(","),l=[parseInt(s[0],10),parseInt(s[1],10),parseInt(s[2],10)])}catch(e){}return{w3:e,pv:l,wk:r,ie:o,win:n,mac:i}}();N.w3&&((typeof g.readyState!=m&&"complete"==g.readyState||typeof g.readyState==m&&(g.getElementsByTagName("body")[0]||g.body))&&t(),i||(typeof g.addEventListener!=m&&g.addEventListener("DOMContentLoaded",t,!1),N.ie&&N.win&&(g.attachEvent(e,function(){"complete"==g.readyState&&(g.detachEvent(e,arguments.callee),t())}),h==top&&function(){if(!i){try{g.documentElement.doScroll("left")}catch(e){return setTimeout(arguments.callee,0)}t()}}()),N.wk&&function(){i||(/loaded|complete/.test(g.readyState)?t():setTimeout(arguments.callee,0))}(),T(t)));function t(){if(!i){try{var e=g.getElementsByTagName("body")[0].appendChild(V("span"));e.parentNode.removeChild(e)}catch(e){return}i=!0;for(var t=n.length,a=0;a<t;a++)n[a]()}}function a(e){i?e():n[n.length]=e}function T(e){var t,a,n;if("bbs"!==window.imSource)if(typeof h.addEventListener!=m)h.addEventListener("load",e,!1);else if(typeof g.addEventListener!=m)g.addEventListener("load",e,!1);else if(typeof h.attachEvent!=m)a="onload",n=e,(t=h).attachEvent(a,n),o[o.length]=[t,a,n];else if("function"==typeof h.onload){var i=h.onload;h.onload=function(){i(),e()}}else h.onload=e;else e()}function I(){var e=E.length;if(0<e)for(var t=0;t<e;t++){var a=E[t].id,n=E[t].callbackFn,i={success:!1,id:a};if(0<N.pv[0]){var r=M(a);if(r)if(!P(E[t].swfVersion)||N.wk&&N.wk<312)if(E[t].expressInstall&&k()){var o={};o.data=E[t].expressInstall,o.width=r.getAttribute("width")||"0",o.height=r.getAttribute("height")||"0",r.getAttribute("class")&&(o.styleclass=r.getAttribute("class")),r.getAttribute("align")&&(o.align=r.getAttribute("align"));for(var l={},s=r.getElementsByTagName("param"),c=s.length,f=0;f<c;f++)"movie"!=s[f].getAttribute("name").toLowerCase()&&(l[s[f].getAttribute("name")]=s[f].getAttribute("value"));B(o,l,a,n)}else O(r),n&&n(i);else D(a,!0),n&&(i.success=!0,i.ref=L(a),n(i))}else if(D(a,!0),n){var d=L(a);d&&typeof d.SetVariable!=m&&(i.success=!0,i.ref=d),n(i)}}}function L(e){var t=null,a=M(e);if(a&&"OBJECT"==a.nodeName)if(typeof a.SetVariable!=m)t=a;else{var n=a.getElementsByTagName(w)[0];n&&(t=n)}return t}function k(){return!A&&P("6.0.65")&&(N.win||N.mac)&&!(N.wk&&N.wk<312)}function B(e,t,a,n){f=n||null,d={success:!(A=!0),id:a};var i=M(a);if(i){"OBJECT"==i.nodeName?(s=j(i),c=null):(s=i,c=a),e.id=y,(typeof e.width==m||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==m||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),g.title=g.title.slice(0,47)+" - Flash Player Installation";var r=N.ie&&N.win?"ActiveX":"PlugIn",o="MMredirectURL="+h.location.toString().replace(/&/g,"%26")+"&MMplayerType="+r+"&MMdoctitle="+g.title;if(typeof t.flashvars!=m?t.flashvars+="&"+o:t.flashvars=o,N.ie&&N.win&&4!=i.readyState){var l=V("div");a+="SWFObjectNew",l.setAttribute("id",a),i.parentNode.insertBefore(l,i),i.style.display="none",function(){4==i.readyState?i.parentNode.removeChild(i):setTimeout(arguments.callee,10)}()}x(e,t,a)}}function O(e){if(N.ie&&N.win&&4!=e.readyState){var t=V("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(j(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(j(e),e)}function j(e){var t=V("div");if(N.win&&N.ie)t.innerHTML=e.innerHTML;else{var a=e.getElementsByTagName(w)[0];if(a){var n=a.childNodes;if(n)for(var i=n.length,r=0;r<i;r++)1==n[r].nodeType&&"PARAM"==n[r].nodeName||8==n[r].nodeType||t.appendChild(n[r].cloneNode(!0))}}return t}function x(e,t,a){var n,i=M(a);if(N.wk&&N.wk<312)return n;if(i)if(typeof e.id==m&&(e.id=a),N.ie&&N.win){var r="";for(var o in e)e[o]!=Object.prototype[o]&&("data"==o.toLowerCase()?t.movie=e[o]:"styleclass"==o.toLowerCase()?r+=' class="'+e[o]+'"':"classid"!=o.toLowerCase()&&(r+=" "+o+'="'+e[o]+'"'));var l="";for(var s in t)t[s]!=Object.prototype[s]&&(l+='<param name="'+s+'" value="'+t[s]+'" />');i.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+r+">"+l+"</object>",S[S.length]=e.id,n=M(e.id)}else{var c=V(w);for(var f in c.setAttribute("type",v),e)e[f]!=Object.prototype[f]&&("styleclass"==f.toLowerCase()?c.setAttribute("class",e[f]):"classid"!=f.toLowerCase()&&c.setAttribute(f,e[f]));for(var d in t)t[d]!=Object.prototype[d]&&"movie"!=d.toLowerCase()&&F(c,d,t[d]);i.parentNode.replaceChild(c,i),n=c}return n}function F(e,t,a){var n=V("param");n.setAttribute("name",t),n.setAttribute("value",a),e.appendChild(n)}function $(e){var t=M(e);t&&"OBJECT"==t.nodeName&&(N.ie&&N.win?(t.style.display="none",function(){4==t.readyState?function(e){var t=M(e);if(t){for(var a in t)"function"==typeof t[a]&&(t[a]=null);t.parentNode.removeChild(t)}}(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function M(e){var t=null;try{t=g.getElementById(e)}catch(e){}return t}function V(e){return g.createElement(e)}function P(e){var t=N.pv,a=e.split(".");return a[0]=parseInt(a[0],10),a[1]=parseInt(a[1],10)||0,a[2]=parseInt(a[2],10)||0,t[0]>a[0]||t[0]==a[0]&&t[1]>a[1]||t[0]==a[0]&&t[1]==a[1]&&t[2]>=a[2]}function R(e,t,a,n){if(!N.ie||!N.mac){var i=g.getElementsByTagName("head")[0];if(i){var r=a&&"string"==typeof a?a:"screen";if(n&&(p=l=null),!l||p!=r){var o=V("style");o.setAttribute("type","text/css"),o.setAttribute("media",r),l=i.appendChild(o),N.ie&&N.win&&typeof g.styleSheets!=m&&0<g.styleSheets.length&&(l=g.styleSheets[g.styleSheets.length-1]),p=r}N.ie&&N.win?l&&typeof l.addRule==w&&l.addRule(e,t):l&&typeof g.createTextNode!=m&&l.appendChild(g.createTextNode(e+" {"+t+"}"))}}}function D(e,t){if(r){var a=t?"visible":"hidden";i&&M(e)?M(e).style.visibility=a:R("#"+e,"visibility:"+a)}}function W(e){return null!=/[\\\"<>\.;]/.exec(e)&&typeof encodeURIComponent!=m?encodeURIComponent(e):e}N.ie&&N.win&&window.attachEvent("onunload",function(){for(var e=o.length,t=0;t<e;t++)o[t][0].detachEvent(o[t][1],o[t][2]);for(var a=S.length,n=0;n<a;n++)$(S[n]);for(var i in N)N[i]=null;for(var r in N=null,H)H[r]=null;H=null});return{registerObject:function(e,t,a,n){if(N.w3&&e&&t){var i={};i.id=e,i.swfVersion=t,i.expressInstall=a,i.callbackFn=n,E[E.length]=i,D(e,!1)}else n&&n({success:!1,id:e})},getObjectById:function(e){if(N.w3)return L(e)},embedSWF:function(o,l,s,c,f,d,p,u,v,y){var h={success:!1,id:l};N.w3&&!(N.wk&&N.wk<312)&&o&&l&&s&&c&&f?(D(l,!1),a(function(){s+="",c+="";var e={};if(v&&typeof v===w)for(var t in v)e[t]=v[t];e.data=o,e.width=s,e.height=c;var a={};if(u&&typeof u===w)for(var n in u)a[n]=u[n];if(p&&typeof p===w)for(var i in p)typeof a.flashvars!=m?a.flashvars+="&"+i+"="+p[i]:a.flashvars=i+"="+p[i];if(P(f)){var r=x(e,a,l);e.id==l&&D(l,!0),h.success=!0,h.ref=r}else{if(d&&k())return e.data=d,void B(e,a,l,y);D(l,!0)}y&&y(h)})):y&&y(h)},switchOffAutoHideShow:function(){r=!1},ua:N,getFlashPlayerVersion:function(){return{major:N.pv[0],minor:N.pv[1],release:N.pv[2]}},hasFlashPlayerVersion:P,createSWF:function(e,t,a){return N.w3?x(e,t,a):void 0},showExpressInstall:function(e,t,a,n){N.w3&&k()&&B(e,t,a,n)},removeSWF:function(e){N.w3&&$(e)},createCSS:function(e,t,a,n){N.w3&&R(e,t,a,n)},addDomLoadEvent:a,addLoadEvent:T,getQueryParamValue:function(e){var t=g.location.search||g.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return W(t);for(var a=t.split("&"),n=0;n<a.length;n++)if(a[n].substring(0,a[n].indexOf("="))==e)return W(a[n].substring(a[n].indexOf("=")+1))}return""},expressInstallCallback:function(){if(A){var e=M(y);e&&s&&(e.parentNode.replaceChild(s,e),c&&(D(c,!0),N.ie&&N.win&&(s.style.display="block")),f&&f(d)),A=!1}}}}();a.exports=H});;fangimjs.define("util/drag/1.0.0/drag",["jquery"],function(t){"use strict";var i=t("jquery"),m=i(window),x=i(document),e="createTouch"in document,n=document.documentElement,o=!!("minWidth"in n.style)&&"onlosecapture"in n,s="setCapture"in n,r={start:e?"touchstart":"mousedown",over:e?"touchmove":"mousemove",end:e?"touchend":"mouseup"},h=e?function(t){return t.touches||(t=t.originalEvent.touches.item(0)),t}:function(t){return t},w=function(){this.start=i.proxy(this.start,this),this.over=i.proxy(this.over,this),this.end=i.proxy(this.end,this),this.onstart=this.onover=this.onend=i.noop};return w.types=r,w.prototype={start:function(t){return t=this.startFix(t),x.on(r.over,this.over).on(r.end,this.end),this.onstart(t),!1},over:function(t){return t=this.overFix(t),this.onover(t),!1},end:function(t){return t=this.endFix(t),x.off(r.over,this.over).off(r.end,this.end),this.onend(t),!1},startFix:function(t){return t=h(t),this.target=i(t.target),this.selectstart=function(){return!1},x.on("selectstart",this.selectstart).on("dblclick",this.end),o?this.target.on("losecapture",this.end):m.on("blur",this.end),s&&this.target[0].setCapture(),t},overFix:function(t){return t=h(t)},endFix:function(t){return t=h(t),x.off("selectstart",this.selectstart).off("dblclick",this.end),o?this.target.off("losecapture",this.end):m.off("blur",this.end),s&&this.target[0].releaseCapture(),t}},w.create=function(t,e,o){var r=t[0]?i(t)[0]:t;if(!r)return!1;var h,a,c,u,f=i(r),l=f.width(),d=f.height(),n=new w,s=w.types.start,p=r.className.replace(/^\s|\s.*/g,"")+"-drag-start",v="fixed"===f.css("position"),g={onstart:function(t,e,n){f.css({width:l,height:d,left:e,top:n}),o.onStart&&o.onStart({target:r,event:t,left:e,top:n,width:l,height:d})},onover:i.noop,onend:function(t,e,n){f.css({width:l,height:d,left:e,top:n}),o.onEnd&&o.onEnd({target:r,event:t,left:e,top:n,width:l,height:d})},off:function(){f.off(s,n.start)}};return n.onstart=function(t){var e=x.scrollLeft(),n=x.scrollTop(),o=f.offset();a=h=0,c=v?m.width()-l+h:x.width()-l,u=v?m.height()-d+a:x.height()-d;var s=this.startLeft=v?o.left-e:o.left,i=this.startTop=v?o.top-n:o.top;this.clientX=t.clientX,this.clientY=t.clientY,f.addClass(p),g.onstart.call(r,t,s,i)},n.onover=function(t){var e=t.clientX-this.clientX+this.startLeft,n=t.clientY-this.clientY+this.startTop;e=Math.max(h,Math.min(c,e)),n=Math.max(a,Math.min(u,n));var o=r.style;o.left=e+"px",o.top=n+"px",g.onover.call(r,t,e,n)},n.onend=function(t){var e=x.scrollLeft(),n=x.scrollTop(),o=f.offset(),s=v?o.left-e:o.left,i=v?o.top-n:o.top;f.removeClass(p),g.onend.call(r,t,s,i)},e?n.start(e):f.on(s,n.start),g},w});