this.login={};(function(window,$){var defaults={normal:{User:"txt_username",PassWord:"txt_password",Code:"validateCode",Tips:"error_esfds",Button:"getcode"},code:{img:"login_vcode",vk:"hidValidate",parentcode:"vcode"},backurl:"http://my.fang.com"};function OpenOfRefresh(){if(null!=window.opener){try{var openwin=window.opener;openwin.location.reload()}catch(e){return}}}function showmsg(msg){if(msg=="Success"){IsLogin(function(data){window.setLoginTopBar(data)});jQuery("#div_Login").hide();login.callbak()}else{jQuery("."+defaults.normal.Tips).html(msg);jQuery("."+defaults.normal.Tips).css("display","block");ReFreshVCode(defaults.code.img,90,32)}$("#login").removeAttr("disabled")}$("#login").on("click",function(){$(this).attr("disabled",true);var user=$("#"+defaults.normal.User),pwd=$("#"+defaults.normal.PassWord),code=$("#"+defaults.normal.Code),uservalue=$.trim(user.val()),pwdvalue=$.trim(pwd.val()),codevalue=$.trim(code.val());if(uservalue===""||uservalue==="手机号/邮箱/用户名"){$("#"+defaults.normal.Tips).html("请输入您的手机号").show();user[0].focus();$(this).removeAttr("disabled");return}if(pwdvalue===""){$("#"+defaults.normal.Tips).html("请输入您的密码").show();pwd[0].focus();$(this).removeAttr("disabled");return}if(jQuery("#login_vcode").is(":visible")){if(codevalue===""){$("#"+defaults.normal.Tips).html("请输入验证码").show();code[0].focus();$(this).removeAttr("disabled")}}var result=checkGroup.checkCode(codevalue);if(result.isChecked){var backurl="http://"+window.location.hostname+"/RentInput/Others/LoginCookiesWriter.aspx";var _sflogin=_sflogin||{};_sflogin.nameid="txt_username";_sflogin.pwdid="txt_password";_sflogin.formId="loginForm";_sflogin.needvcode=true;_sflogin.txt_vcodeid=defaults.normal.Code;_sflogin.img_vcodeid=defaults.code.img;_sflogin.div_vcodeid=defaults.code.parentcode;_sflogin.backurl=backurl;LoginSubmit(_sflogin)}else{$("#"+defaults.normal.Tips).html(result.msg).show();code.focus();$(this).attr("disabled",false)}});function errorcount(nameid,div_vcodeid){$.ajax({type:"get",url:"https://passport.fang.com/GetLoginErrorCountInterface/GetErrorCount?",dataType:"jsonp",jsonp:"jsonpCallback",jsonpCallback:"success",data:{Uid:document.getElementById(nameid).value,Service:SFLogin.Service,Callback:"success"},cache:false,success:function(json){if(json.Message=="Success"){if(parseInt(json.LoginErrorCount)>=4){document.getElementById(div_vcodeid).style.display=""}else{document.getElementById(div_vcodeid).style.display="none"}}}})}function ReFreshVCode(img_vcodeid){var isnorth="<%=citysite.IsNorth.ToLower()%>";var vdomain="http://Captchas.fang.com/";var v_rand=Math.round(Math.random()*10000000000);var img_vcode=document.getElementById(img_vcodeid);if(img_vcode){img_vcode.setAttribute("src",vdomain+"Display?type=soufangbang&r="+v_rand)}}function ResEncode(pwd){return encryptedString(key,pwd||"")}function LoginSubmit(o){if(o.needvcode){errorcount(o.nameid,o.div_vcodeid);if(document.getElementById(o.txt_vcodeid)){document.getElementById("vcode_hidden").value=document.getElementById(o.txt_vcodeid).value}}document.getElementById("Uid").value=encodeURI(document.getElementById(o.nameid).value);document.getElementById("Pwd").value=ResEncode(document.getElementById(o.pwdid).value);document.getElementById("Service").value=SFLogin.Service;if(o.backurl){document.getElementById("backurl").value=encodeURI(o.backurl)}var LoginForm=document.getElementById(o.formId);LoginForm.action="https://passport.fang.com/NormalLoginInterface/Login";var isIE=document.all&&window.external;var IFrame=document.getElementById("loginIfram_txz");if(!IFrame){IFrame=isIE?document.createElement("<iframe name='loginIfram_txz' >"):document.createElement("iframe")}IFrame.name="loginIfram_txz";IFrame.id="loginIfram_txz";IFrame.style.visibility="hidden";IFrame.style.width=IFrame.style.height="0px";document.body.appendChild(IFrame);LoginForm.target=IFrame.name;LoginForm.submit()}var checkGroup={checkCode:function(val){var resultObj={isChecked:false,msg:""};resultObj.isChecked=true;return resultObj},checkMobile:function(mobile){var result=false;if(mobile!==""&&mobile!=="请输入手机号码"){var reg=/^(13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9]|95013)\d{8}$/;if(reg.test(mobile)){result=true}}return result}};var autoTimer={timer:{},time:90,isgetpass:false,count:function(){var passtime=document.getElementById("passtime");if(!passtime){return}passtime.innerHTML=this.time;if(this.time>=0){while(this.time==0){document.getElementById("getpass").style.display="";document.getElementById("_mobileerror").innerHTML="";clearInterval(this.timer);this.time=90;return}this.time--}}};function ShowLogin(callback){$("#div_Login").show();login.callbak=callback}ReFreshVCode(SFLogin.Img_vcodeid);window.ReFreshVCode=ReFreshVCode;window.autoTimer=autoTimer;window.showmsg=showmsg;function IsLogin(callbak){var b=false;$.ajax({url:"/RentDetails/PostService/DefaultUserLogin.aspx?method=init",type:"get",dataType:"json",cache:false,async:false}).done(function(data){if(typeof callbak=="function"){callbak(data)}if(data.result=="100"){var newcookie2=getsecondnameCookie("agent_validation","a");
if(newcookie2!="1"&&newcookie2!="4"){b=true}}});return b}login.showlogin=ShowLogin;login.IsLogin=IsLogin}(window,jQuery));