 <include file="Public:head" /> 
  <div class="content" style="width:86%; border:none; margin-bottom:30px;" > 
 <link rel="stylesheet" type="text/css" href="{weiwin::RES}/css/cymain.css" />
<script src="{weiwin::RES}/js/date/WdatePicker.js"></script>
<script type="text/javascript" src="{weiwin::RES}/js/formCheck/formcheck.js"> </script>

<script src="/tpl/static/artDialog/jquery.artDialog.js?skin=default"></script>
<script src="/tpl/static/artDialog/plugins/iframeTools.js"></script>
<link rel="stylesheet" href="{weiwin::STATICS}/kindeditor/themes/default/default.css" />
<link rel="stylesheet" href="{weiwin::STATICS}/kindeditor/plugins/code/prettify.css" />
<script src="{weiwin::STATICS}/kindeditor/kindeditor.js" type="text/javascript"></script>
<script src="{weiwin::STATICS}/kindeditor/lang/zh_CN.js" type="text/javascript"></script>
<script src="{weiwin::STATICS}/kindeditor/plugins/code/prettify.js" type="text/javascript"></script>
<script src="{weiwin::STATICS}/kindeditor/plugins/code/prettify.js" type="text/javascript"></script>
<script>
  KindEditor.ready(function(K){
    var editor = K.editor({
      allowFileManager:true
    });
    K('#upload_pic').click(function() {
      editor.loadPlugin('image', function() {
        editor.plugin.imageDialog({
          fileUrl : K('#pic').val(),
          clickFn : function(url, title) {
            if(url.indexOf("http") > -1){
              K('#pic').val(url);
            }else{
              K('#pic').val("{weiwin::C('site_url')}"+url);
            }
            editor.hideDialog();
          }
        });
      });
    });
    K('#upload_opening_animation').click(function() {
      editor.loadPlugin('image', function() {
        editor.plugin.imageDialog({
          fileUrl : K('#opening_animation').val(),
          clickFn : function(url, title) {
            if(url.indexOf("http") > -1){
              K('#opening_animation').val(url);
            }else{
              K('#opening_animation').val("{weiwin::C('site_url')}"+url);
            }
            editor.hideDialog();
          }
        });
      });
    });
    K('#upload_small_pic').click(function() {
      editor.loadPlugin('image', function() {
        editor.plugin.imageDialog({
          fileUrl : K('#small_pic').val(),
          clickFn : function(url, title) {
            if(url.indexOf("http") > -1){
              K('#small_pic').val(url);
            }else{
              K('#small_pic').val("{weiwin::C('site_url')}"+url);
            }
            editor.hideDialog();
          }
        });
      });
    });
    K('#upload_site_map_1').click(function() {
      editor.loadPlugin('image', function() {
        editor.plugin.imageDialog({
          fileUrl : K('#site_map_1').val(),
          clickFn : function(url, title) {
            if(url.indexOf("http") > -1){
              K('#site_map_1').val(url);
            }else{
              K('#site_map_1').val("{weiwin::C('site_url')}"+url);
            }
            editor.hideDialog();
          }
        });
      });
    });
    K('#upload_site_map_2').click(function() {
      editor.loadPlugin('image', function() {
        editor.plugin.imageDialog({
          fileUrl : K('#site_map_2').val(),
          clickFn : function(url, title) {
            if(url.indexOf("http") > -1){
              K('#site_map_2').val(url);
            }else{
              K('#site_map_2').val("{weiwin::C('site_url')}"+url);
            }
            editor.hideDialog();
          }
        });
      });
    });
    K('#upload_site_map_3').click(function() {
      editor.loadPlugin('image', function() {
        editor.plugin.imageDialog({
          fileUrl : K('#site_map_3').val(),
          clickFn : function(url, title) {
            if(url.indexOf("http") > -1){
              K('#site_map_3').val(url);
            }else{
              K('#site_map_3').val("{weiwin::C('site_url')}"+url);
            }
            editor.hideDialog();
          }
        });
      });
    });
    K('#upload_site_map_4').click(function() {
      editor.loadPlugin('image', function() {
        editor.plugin.imageDialog({
          fileUrl : K('#site_map_4').val(),
          clickFn : function(url, title) {
            if(url.indexOf("http") > -1){
              K('#site_map_4').val(url);
            }else{
              K('#site_map_4').val("{weiwin::C('site_url')}"+url);
            }
            editor.hideDialog();
          }
        });
      });
    });
    K('#upload_site_map_5').click(function() {
      editor.loadPlugin('image', function() {
        editor.plugin.imageDialog({
          fileUrl : K('#site_map_5').val(),
          clickFn : function(url, title) {
            if(url.indexOf("http") > -1){
              K('#site_map_5').val(url);
            }else{
              K('#site_map_5').val("{weiwin::C('site_url')}"+url);
            }
            editor.hideDialog();
          }
        });
      });
    });
  });
</script>

<script>

var editor;
KindEditor.ready(function(K) {
editor = K.create('#content', {
resizeType : 1,
allowPreviewEmoticons : false,
allowImageUpload : false,
items : [
'source','undo','clearhtml','hr',
'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
'insertunorderedlist', '|', 'emoticons', 'image','link', 'unlink','baidumap','lineheight','table','anchor','preview','print','template','code','cut']
});

});
</script>
<script type="text/javascript">
function setlatlng(longitude,latitude){
  art.dialog.data('longitude', longitude);
  art.dialog.data('latitude', latitude);
  // 此时 iframeA.html 页面可以使用 art.dialog.data('test') 获取到数据，如：
  // document.getElementById('aInput').value = art.dialog.data('test');
  art.dialog.open('{weiwin::U('Map/setLatLng',array('token'=>$token,'id'=>$id))}',{lock:false,title:'设置经纬度',width:600,height:400,yesText:'关闭',background: '#000',opacity: 0.87});
}
</script>
   <div class="cLineB"> 
    <h4>广告位设置</h4> 
    <a href="{weiwin::U('Advert/index',array('token'=>$token))}" class="right  btnGreen" style="margin-top:-27px">返回</a> 
   </div> 
   

   <form class="form" method="post" id="form" action=""> 
<if condition="$isUpdate eq 1">
<input type="hidden" name="id" value="{weiwin:$set.id}" />
</if>

    <div class="msgWrap bgfc"> 
     <table class="userinfoArea" style=" margin:0;" border="0" cellspacing="0" cellpadding="0" width="100%"> 
      <tbody> 
       <tr> <input id="token" name="token" type="hidden" value="{weiwin::$token}"></tr>
        <tr>
        <th><span class="red">*</span>广告名称：</th>
        <td><input type="text" id="advertname" name="advertname" value="{weiwin:$set.advertname}" class="px require" style="width:400px;" /></td> 
       </tr>

        <tr> 
          <th><span class="red">*</span>商品类别：</th>
          <td>
            <select id="pcid" name="pcid"  class="px require" style="width:400px;" onChange="productcatSelect(this.value);">
              <option value="">--请选择--</option>
              <volist name="products" id="pc">
              <option value="{weiwin:$pc.id}" <if condition="$set['pcid'] eq $pc['id']">selected</if>>{weiwin:$pc.name}</option>
              </volist>
            </select>
          </td> 
       </tr>

       <tr> 
          <th><span class="red">*</span>选择商品：</th>
          <td>
            <select id="pid" name="pid"  class="px require" style="width:400px;">
              <option value="">--请选择--</option>
              <volist name="product" id="p">
              <option value="{weiwin:$p.id}" <if condition="$set['pid'] eq $p['id']">selected</if>>{weiwin:$p.name}</option>
              </volist>
            </select>
          </td> 
       </tr> 
       <tr>

          <th><span class="red">*</span>广告图片：</th>

          <td><input type="text" name="picurl" value="{weiwin:$set.picurl}" id="pic" class="px" style="width:550px;"> &nbsp; <script src="/tpl/static/upyun.js"></script><a href="###" onclick="upyunPicUpload('pic',700,420,'{weiwin:$token}')" class="a_upload">上传</a> &nbsp; <a href="###" onclick="viewImg('pic')" class="btnGrayS vm">预览</a> &nbsp; 建议大小为600x200</td>

        </tr>

        <tr>
        <th><span class="red">*</span>排序：</th>
        <td><input type="text" id="sort" name="sort" value="{weiwin:$set.sort
          |default=1}" class="px require" style="width:400px;" />
          <span>由小到大排序</span>
        </td> 
       </tr>

       <tr>
       <th>&nbsp;</th>
       <td>
       <button type="submit" name="button" class="btnGreen" onclick="return abc()">保存</button> &nbsp; <a href="{weiwin::U('Advert/index',array('token'=>$token))}" class="btnGray vm">取消</a></td> 
       </tr> 
      </tbody> 
     </table> 
     </div>
    
   </form> 
  </div> 
<script language="javascript">
//表单提交时检验
  function abc(){
    var advertname=$("#advertname").val();
    var pid=$("#pid").val();
    var pcid=$("#pcid").val();
    var pic=$("#pic").val();
    if(!advertname){
      alert("请填写广告名称");
      return false;
    }
    if(!pcid){
      alert("请选择商品类别");
      return false;
    }
    if(!pid){
      alert("请选择商品");
      return false;
    }
    if(pic==""){
      alert("请上传广告图片");
      return false;
    }
  }
  //选择省份后切换相应的城市
  function productcatSelect(pcid){
    var strs="<option value=''>请选择商品</option>",pid="";

    document.getElementById('pid').innerHTML="<option value=''>请选择商品</option>";
    $.post("index.php?g=User&m=Advert&a=productChange", {'pcid':pcid}, function(res) {
            
          var res = JSON.parse(res);

          if(res!=null)
          {
            for(var i=0;i<res.length;i++)
            {
              if(res[i]["catid"]!="undefined")
              {
                strs+='<option value="'+res[i]["id"]+'">'+res[i]["name"]+'</option>';
                document.getElementById('pid').innerHTML=strs;
                pid=res[0]["catid"];
              }
            }
          }
    });
  }
  //校验数据
$(function(){
  $("#form").valid([
  { name:"pid",simple:"商品",require:true},
  { name:"pcid",simple:"商品类别",require:true},
  { name:"advertname",simple:"广告名称",require:true},
  { name:"picurl",simple:"广告图片",require:true}
  ],true,true);
})
</script>
  <include file="Public:footer" />